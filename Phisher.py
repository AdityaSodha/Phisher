import base64
suz1 = "ZnJvbSBhcmdwYXJzZSBpbXBvcnQgQXJndW1lbnRQYXJzZXIKZnJvbSBpbXBvcnRsaWIgaW1wb3J0IGltcG9ydF9tb2R1bGUgYXMgZXhpbXBvcnQKZnJvbSBoYXNobGliIGltcG9ydCBzaGEyNTYKZnJvbSBqc29uIGltcG9ydCAoCiAgICBkdW1wcyBhcyBzdHJpbmdpZnksCiAgICBsb2FkcyBhcyBwYXJzZQopCmZyb20gb3MgaW1wb3J0ICgKICAgIGdldGVudiwKICAgIGtpbGwsCiAgICBsaXN0ZGlyLAogICAgbWFrZWRpcnMsCiAgICBta2RpciwKICAgIG1rbm9kLAogICAgcG9wZW4sCiAgICByZW1vdmUsCikKZnJvbSBvcy5wYXRoIGltcG9ydCAoCiAgICBhYnNwYXRoLAogICAgYmFzZW5hbWUsCiAgICBkaXJuYW1lLAogICAgaXNkaXIsCiAgICBpc2ZpbGUsCiAgICBqb2luCikKZnJvbSBwbGF0Zm9ybSBpbXBvcnQgdW5hbWUKZnJvbSByZSBpbXBvcnQgc2VhcmNoLCBzdWIKZnJvbSBzaHV0aWwgaW1wb3J0ICgKICAgIGNvcHkyLAogICAgZ2V0X3Rlcm1pbmFsX3NpemUsCiAgICBybXRyZWUsCikKZnJvbSBzaWduYWwgaW1wb3J0ICgKICAgIFNJR0lOVCwKKQpmcm9tIHN1YnByb2Nlc3MgaW1wb3J0ICgKICAgIERFVk5VTEwsCiAgICBQSVBFLAogICAgUG9wZW4sCiAgICBydW4KKQpmcm9tIHNtdHBsaWIgaW1wb3J0IFNNVFBfU1NMIGFzIHNtdHAKZnJvbSBzeXMgaW1wb3J0ICgKICAgIHN0ZG91dCwKICAgIHZlcnNpb25faW5mbwopCmZyb20gdGFyZmlsZSBpbXBvcnQgb3BlbiBhcyB0YXJvcGVuCmZyb20gdGltZSBpbXBvcnQgKAogICAgc2xlZXAsCikKZnJvbSB6aXBmaWxlIGltcG9ydCBaaXBGaWxlCgoKIyBDb2xvciBzbmlwcGV0cwpibGFjaz0iXDAzM1swOzMwbSIKcmVkPSJcMDMzWzA7MzFtIgpicmVkPSJcMDMzWzE7MzFtIgpncmVlbj0iXDAzM1swOzMybSIKYmdyZWVuPSJcMDMzWzE7MzJtIgp5ZWxsb3c9IlwwMzNbMDszM20iCmJ5ZWxsb3c9IlwwMzNbMTszM20iCmJsdWU9IlwwMzNbMDszNG0iCmJibHVlPSJcMDMzWzE7MzRtIgpwdXJwbGU9IlwwMzNbMDszNW0iCmJwdXJwbGU9IlwwMzNbMTszNW0iCmN5YW49IlwwMzNbMDszNm0iCmJjeWFuPSJcMDMzWzE7MzZtIgp3aGl0ZT0iXDAzM1swOzM3bSIKbmM9IlwwMzNbMDBtIgoKdmVyc2lvbj0iMS4yLjEiCgojIFJlZ3VsYXIgU25pcHBldHMKYXNrICA9ICAgICBmIntncmVlbn1be2dyZWVufT97Z3JlZW59XSB7Z3JlZW59IgpzdWNjZXNzID0gZiJ7Z3JlZW59W3tncmVlbn3iiJp7Z3JlZW59XSB7Z3JlZW59IgplcnJvciAgPSAgICBmIntncmVlbn1be2dyZWVufSF7Z3JlZW59XSB7Z3JlZW59IgppbmZvICA9ICAgZiJ7Z3JlZW59W3tncmVlbn0re2dyZWVufV0ge2dyZWVufSIKaW5mbzIgID0gICBmIntncmVlbn1be2dyZWVufeKAontncmVlbn1dIHtncmVlbn0iCgoKbG9nbyA9IGYiIiIKe2dyZWVufSAgICAgICAgICAgICAgICAgICBfX19fICBfICAgICBfICAgICBfCntncmVlbn0gICAgICAgICAgICAgICAgICB8ICBfIFx8IHxfXyAoXylfX198IHxfXyAgIF9fXyBfIF9fCntncmVlbn0gICAgICAgICAgICAgICAgICB8IHxfKSB8ICdfIFx8IC8gX198ICdfIFwgLyBfIFwgJ19ffAp7Z3JlZW59ICAgICAgICAgICAgICAgICAgICB8X18vfCB8IHwgfCBcX18gXCB8IHwgfCAgX18vIHwKe2dyZWVufSAgICAgICAgICAgICAgICAgICBffHwgIHxffCB8X3xffF9fXy9ffCB8X3xcX19ffF98CntncmVlbn17IiAiKjM1fSAgICAgICAgIFt7Z3JlZW59dnt2ZXJzaW9uWzoxXX17Z3JlZW59XQp7Z3JlZW59eyIgIiozNn1be2dyZWVufUJ5IHtncmVlbn1BZGl0eWEgU29kaGF7Z3JlZW59XQoiIiIKCmx4X2hlbHAgPSBmIiIiCntpbmZvfVN0ZXBzOiB7bmN9CntncmVlbn1bMV17Z3JlZW59IEdvIHRvIHtncmVlbn1odHRwczovL2xvY2FseHBvc2UuaW8Ke2dyZWVufVsyXXtncmVlbn0gQ3JlYXRlIGFuIGFjY291bnQgCntncmVlbn1bM117Z3JlZW59IExvZ2luIHRvIHlvdXIgYWNjb3VudAp7Z3JlZW59WzRde2dyZWVufSBWaXNpdCB7Z3JlZW59aHR0cHM6Ly9sb2NhbHhwb3NlLmlvL2Rhc2hib2FyZC9hY2Nlc3N7Z3JlZW59IGFuZCBjb3B5IHlvdXIgYXV0aHRva2VuCiIiIgpzaGFkb3dfaGVscD0iIiIKU2hhZG93IHVybCBpcyB0aGUgdXJsIGZyb20gd2hpY2ggd2Vic2l0ZSBwcmV2aWV3cyBhcmUgY29waWVkLgpXaGVuIHNlbmRpbmcgdXJsIHRocm91Z2ggc29jaWFsIG1lZGlhIGxpa2UgZmFjZWJvb2svdGVsZWdyYW0sIAp0aGUgcHJldmlld3MgYXJlIHNob3duIGp1c3QgYmVsb3cgdGhlIHVybAoiIiIKcmVkaXJfaGVscD0iIiIKUmVkaXJlY3Rpb24gdXJsIGlzIHRoZSB1cmwgd2hpY2ggaXMgdXNlZCB0byByZWRpcmVjdCB2aWN0aW0gYWZ0ZXIgc3VjY2Vzc2Z1bCBsb2dpbgoiIiIKY3VybF9oZWxwPSIiIgpKdXN0IGEgc2hvcnRlbmVkIHVybCB3aXRoIHlvdXIgb3duIG1hc2tpbmcKIiIiCnppcF9oZWxwPSIiIgpBZGQgbW9yZSB0ZW1wbGF0ZXMgZnJvbSBhIHppcCBmaWxlIHdoaWNoIHdpbGwgYmUgZG93bmxvYWRlZCBmcm9tIGlucHV0IHVybAoiIiIKCnBhY2thZ2VzID0gWyAiZ2l0IiwgInBocCIsICJzc2giIF0KbW9kdWxlcyA9IFsgInJlcXVlc3RzIiwgInJpY2giLCAiYmVhdXRpZnVsc291cDQ6YnM0IiBdCnR1bm5lbGVycyA9IFsgImNsb3VkZmxhcmVkIiwgImxvY2x4IiBdCnByb2Nlc3NlcyA9IFsgInBocCIsICJzc2giLCAiY2xvdWRmbGFyZWQiLCAibG9jbHgiLCAibG9jYWx4cG9zZSIsIF0KZXh0ZW5zaW9ucyA9IFsgInBuZyIsICJnaWYiLCAid2VibSIsICJta3YiLCAibXA0IiwgIm1wMyIsICJ3YXYiLCAib2dnIiBdCgp0cnk6CiAgICB0ZXN0ID0gcG9wZW4oImNkICRIT01FICYmIHB3ZCIpLnJlYWQoKQpleGNlcHQ6CiAgICBleGl0KCkKCnN1cHBvcnRlZF92ZXJzaW9uID0gMwoKaWYgdmVyc2lvbl9pbmZvWzBdICE9IHN1cHBvcnRlZF92ZXJzaW9uOgogICAgcHJpbnQoZiJ7ZXJyb3J9T25seSBQeXRob24gdmVyc2lvbiB7c3VwcG9ydGVkX3ZlcnNpb259IGlzIHN1cHBvcnRlZCFcbllvdXIgcHl0aG9uIHZlcnNpb24gaXMge3ZlcnNpb25faW5mb1swXX0iKQogICAgZXhpdCgwKQoKZm9yIG1vZHVsZSBpbiBtb2R1bGVzOgogICAgaWYgIjoiIGluIG1vZHVsZToKICAgICAgICBtb2R1bGUsIGltcG9ydGVyID0gbW9kdWxlLnNwbGl0KCI6IikKICAgIGVsc2U6CiAgICAgICAgaW1wb3J0ZXIgPSBtb2R1bGUKICAgIHRyeToKICAgICAgICBleGltcG9ydChpbXBvcnRlcikKICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGYiSW5zdGFsbGluZyB7bW9kdWxlfSIpCiAgICAgICAgICAgIHJ1bihmInBpcDMgaW5zdGFsbCB7bW9kdWxlfSAtLWJyZWFrLXN5c3RlbS1wYWNrYWdlcyIsIHNoZWxsPVRydWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwcmludChmInttb2R1bGV9IGNhbm5vdCBiZSBpbnN0YWxsZWQhIEluc3RhbGwgaXQgbWFudWFsbHkgYnkge2dyZWVufSdwaXAzIGluc3RhbGwge21vZHVsZX0nIikKICAgICAgICAgICAgZXhpdCgxKQogICAgZXhjZXB0OgogICAgICAgIGV4aXQoMSkKCmZvciBtb2R1bGUgaW4gbW9kdWxlczoKICAgIGlmICI6IiBpbiBtb2R1bGU6CiAgICAgICAgbW9kdWxlLCBpbXBvcnRlciA9IG1vZHVsZS5zcGxpdCgiOiIpCiAgICBlbHNlOgogICAgICAgIGltcG9ydGVyID0gbW9kdWxlCiAgICB0cnk6CiAgICAgICAgZXhpbXBvcnQoaW1wb3J0ZXIpCiAgICBleGNlcHQ6CiAgICAgICAgcHJpbnQoZiJ7bW9kdWxlfSBjYW5ub3QgYmUgaW5zdGFsbGVkISBJbnN0YWxsIGl0IG1hbnVhbGx5IGJ5IHtncmVlbn0ncGlwMyBpbnN0YWxsIHttb2R1bGV9JyIpCiAgICAgICAgZXhpdCgxKQoKZnJvbSByZXF1ZXN0cyBpbXBvcnQgKCAKICAgIGdldCwKICAgIGhlYWQsIAogICAgU2Vzc2lvbgopCmZyb20gYnM0IGltcG9ydCBCZWF1dGlmdWxTb3VwCmZyb20gcmVxdWVzdHMuZXhjZXB0aW9ucyBpbXBvcnQgQ29ubmVjdGlvbkVycm9yCmZyb20gcmljaC5jb25zb2xlIGltcG9ydCBDb25zb2xlCmZyb20gcmljaC5wYW5lbCBpbXBvcnQgUGFuZWwKZnJvbSByaWNoLnByb2dyZXNzIGltcG9ydCAoCiAgICBCYXJDb2x1bW4sCiAgICBQcm9ncmVzcywKICAgIFRleHRDb2x1bW4sCiAgICBUaW1lUmVtYWluaW5nQ29sdW1uLAogICAgVHJhbnNmZXJTcGVlZENvbHVtbgopCmZyb20gcmljaC50cmFjZWJhY2sgaW1wb3J0IGluc3RhbGwgYXMgb3ZlcnJpZGVfZGVmYXVsdF90cmFjZWJhY2sKCm92ZXJyaWRlX2RlZmF1bHRfdHJhY2ViYWNrKCkKY3ByaW50ID0gQ29uc29sZSgpLnByaW50Cgpjb2x1bW5zID0gZ2V0X3Rlcm1pbmFsX3NpemUoKS5jb2x1bW5zCgpyZXBvX3VybCA9ICJodHRwczovL2dpdGh1Yi5jb20vXHg0Ylx4NjFceDczXHg1Mlx4NmZceDc1XHg2NFx4NzJceDYxL01heFBoaXNoZXIiCnNpdGVzX3JlcG8gPSAiaHR0cHM6Ly9naXRodWIuY29tL0thc1JvdWRyYTIvbWF4ZmlsZXMiCndlYnNpdGVzX3VybCA9IGYie3NpdGVzX3JlcG99L2FyY2hpdmUvbWFpbi56aXAiCnJlcG9fYnJhbmNoID0gIm1heGZpbGVzLW1haW4iCgoKCmhvbWUgPSBnZXRlbnYoIkhPTUUiKQpzc2hfZGlyID0gZiJ7aG9tZX0vLnNzaCIKc2l0ZXNfZGlyID0gZiJ7aG9tZX0vLm1heHNpdGVzIgp0ZW1wbGF0ZXNfZmlsZSA9IGYie3NpdGVzX2Rpcn0vdGVtcGxhdGVzLmpzb24iCnR1bm5lbGVyX2RpciA9IGYie2hvbWV9Ly50dW5uZWxlciIKcGhwX2ZpbGUgPSBmInt0dW5uZWxlcl9kaXJ9L3BocC5sb2ciCmNmX2ZpbGUgPSBmInt0dW5uZWxlcl9kaXJ9L2NmLmxvZyIKbHhfZmlsZSA9IGYie3R1bm5lbGVyX2Rpcn0vbG9jbHgubG9nIgpsaHJfZmlsZSA9IGYie3R1bm5lbGVyX2Rpcn0vbGhyLmxvZyIKc3ZvX2ZpbGUgPSBmInt0dW5uZWxlcl9kaXJ9L3N2by5sb2ciCnNpdGVfZGlyID0gZiJ7aG9tZX0vLnNpdGUiCmNyZWRfZmlsZSA9IGYie3NpdGVfZGlyfS91c2VybmFtZXMudHh0IgppcF9maWxlID0gZiJ7c2l0ZV9kaXJ9L2lwLnR4dCIKaW5mb19maWxlID0gZiJ7c2l0ZV9kaXJ9L2luZm8udHh0Igpsb2NhdGlvbl9maWxlID0gZiJ7c2l0ZV9kaXJ9L2xvY2F0aW9uLnR4dCIKbG9nX2ZpbGUgPSBmIntzaXRlX2Rpcn0vbG9nLnR4dCIKbWFpbl9pcCA9ICJpcC50eHQiCm1haW5faW5mbyA9ICJpbmZvLnR4dCIKbWFpbl9jcmVkID0gImNyZWRzLnR4dCIKbWFpbl9sb2NhdGlvbiA9ICJsb2NhdGlvbi50eHQiCmNyZWRfanNvbiA9ICJjcmVkcy5qc29uIgppbmZvX2pzb24gPSAiaW5mby5qc29uIgpsb2NhdGlvbl9qc29uID0gImxvY2F0aW9uLmpzb24iIAplbWFpbF9maWxlID0gImZpbGVzL2VtYWlsLmpzb24iCmVycm9yX2ZpbGUgPSAiZXJyb3IubG9nIgppc19tYWlsX29rID0gRmFsc2UKcmVkaXJfdXJsID0gIiIKZW1haWwgPSAiIgpwYXNzd29yZCA9ICIiCnJlY2VpdmVyID0gIiIKY2ZfY29tbWFuZCA9IGYie3R1bm5lbGVyX2Rpcn0vY2xvdWRmbGFyZWQiCmx4X2NvbW1hbmQgPSBmInt0dW5uZWxlcl9kaXJ9L2xvY2x4IgppZiBpc2RpcigiL2RhdGEvZGF0YS9jb20udGVybXV4L2ZpbGVzL2hvbWUiKToKICAgIHRlcm11eCA9IFRydWUKICAgIGNmX2NvbW1hbmQgPSBmInRlcm11eC1jaHJvb3Qge2NmX2NvbW1hbmR9IgogICAgbHhfY29tbWFuZCA9IGYidGVybXV4LWNocm9vdCB7bHhfY29tbWFuZH0iCiAgICBzYXZlZF9maWxlID0gIi9zZGNhcmQvLmNyZWRzLnR4dCIKZWxzZToKICAgIHRlcm11eCA9IEZhbHNlCiAgICBzYXZlZF9maWxlID0gZiJ7aG9tZX0vLmNyZWRzLnR4dCIKCgpwcmludChmIlxue2luZm99d2FpdCBhIHNlY29uZCF7bmN9IikKCgpkZWZhdWx0X3BvcnQgPSA4MDgwCmRlZmF1bHRfdHVubmVsZXIgPSAiQ2xvdWRmbGFyZWQiCmRlZmF1bHRfZmVzdCA9ICJCaXJ0aGRheSIKZGVmYXVsdF95dGlkID0gIjZoSG1rSW5aa01RIgpkZWZhdWx0X2R1cmF0aW9uID0gNTAwMApkZWZhdWx0X3R5cGUgPSAiMiIKZGVmYXVsdF90ZW1wbGF0ZSA9ICIxIgoKCmlmIHRlcm11eDoKICAgIGRlZmF1bHRfZGlyID0gIi9zZGNhcmQvTWVkaWEiCmVsc2U6CiAgICBkZWZhdWx0X2RpciA9IGYie2hvbWV9L01lZGlhIgoKYXJncGFyc2VyID0gQXJndW1lbnRQYXJzZXIoKQoKYXJncGFyc2VyLmFkZF9hcmd1bWVudCgiLXAiLCAiLS1wb3J0IiwgdHlwZT1pbnQsIGRlZmF1bHQ9ZGVmYXVsdF9wb3J0LCBoZWxwPWYiTWF4UGhpc2hlcidzIHNlcnZlciBwb3J0IFtEZWZhdWx0IDoge2RlZmF1bHRfcG9ydH1dIikKYXJncGFyc2VyLmFkZF9hcmd1bWVudCgiLXQiLCAiLS10eXBlIiwgaGVscD0iTWF4UGhpc2hlcidzIHBoaXNoaW5nIHR5cGUgaW5kZXggW0RlZmF1bHQgOiBudWxsXSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1vIiwgIi0tb3B0aW9uIiwgaGVscD0iTWF4UGhpc2hlcidzIHRlbXBsYXRlIGluZGV4IFsgRGVmYXVsdCA6IG51bGwgXSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1UIiwgIi0tdHVubmVsZXIiLCBkZWZhdWx0PWRlZmF1bHRfdHVubmVsZXIsIGhlbHA9ZiJUdW5uZWxlciB0byBiZSBjaG9zZW4gd2hpbGUgdXJsIHNob3J0ZW5pbmcgW0RlZmF1bHQgOiB7ZGVmYXVsdF90dW5uZWxlcn1dIikKYXJncGFyc2VyLmFkZF9hcmd1bWVudCgiLXIiLCAiLS1yZWdpb24iLCBoZWxwPSJSZWdpb24gZm9yIGxvY2x4IFtEZWZhdWx0OiBhdXRvXSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1TIiwgIi0tc3ViZG9tYWluIiwgaGVscD0iU3ViZG9tYWluIGZvciBsb2NseCBbUHJvIEFjY291bnRdIChEZWZhdWx0OiBudWxsKSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1kIiwgIi0tZGlyZWN0b3J5IiwgZGVmYXVsdD1kZWZhdWx0X2RpciwgaGVscD1mIkRpcmVjdG9yeSB3aGVyZSBtZWRpYSBmaWxlcyB3aWxsIGJlIHNhdmVkIFtEZWZhdWx0IDoge2RlZmF1bHRfZGlyfV0iKQphcmdwYXJzZXIuYWRkX2FyZ3VtZW50KCItZiIsICItLWZlc3QiLCBkZWZhdWx0PWRlZmF1bHRfZmVzdCwgaGVscD1mIkZlc3RpdmFsIG5hbWUgZm9yIGZlc3QgdGVtcGxhdGUgW0RlZmF1bHQ6IHtkZWZhdWx0X2Zlc3R9XSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1pIiwgIi0teXRpZCIsIGRlZmF1bHQ9ZGVmYXVsdF95dGlkLCBoZWxwPWYiWW91dHViZSB2aWRlbyBJRCBmb3IgeXR0diB0ZW1wbGF0ZSBbRGVmYXVsdCA6IHtkZWZhdWx0X3l0aWR9IChOQVNBIFZpZGVvKV0iKQphcmdwYXJzZXIuYWRkX2FyZ3VtZW50KCItdSIsICItLXVybCIsIGhlbHA9IlJlZGlyZWN0aW9uIHVybCBmb3IgaXAtdHJhY2tpbmcgb3IgbG9naW4gcGhpc2hpbmcgW0RlZmF1bHQgOiBudWxsXSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi1zIiwgIi0tZHVyYXRpb24iLCB0eXBlPWludCwgZGVmYXVsdD1kZWZhdWx0X2R1cmF0aW9uLCBoZWxwPWYiTWVkaWEgZHVyYXRpb24gd2hpbGUgY2FwdHVyaW5nIFtEZWZhdWx0IDoge2RlZmF1bHRfZHVyYXRpb259KG1zKV0iKQphcmdwYXJzZXIuYWRkX2FyZ3VtZW50KCItbSIsICItLW1vZGUiLCBoZWxwPSJNb2RlIG9mIE1heFBoaXNoZXIgW0RlZmF1bHQ6IG5vcm1hbF0iKQphcmdwYXJzZXIuYWRkX2FyZ3VtZW50KCItZSIsICItLXRyb3VibGVzaG9vdCIsIGhlbHA9IlRyb3VibGVzaG9vdCBhIHR1bm5lbGVyIFtEZWZhdWx0OiBudWxsXSIpCmFyZ3BhcnNlci5hZGRfYXJndW1lbnQoIi0tbm9rZXkiLCBoZWxwPSJVc2UgbG9jYWx0dW5uZWwgd2l0aG91dCBzc2gga2V5IFtEZWZhdWx0OiBGYWxzZV0iLCBhY3Rpb249InN0b3JlX2ZhbHNlIikKYXJncGFyc2VyLmFkZF9hcmd1bWVudCgiLS1ub3VwZGF0ZSIsIGhlbHA9IlNraXAgdXBkYXRlIGNoZWNraW5nIFtEZWZhdWx0IDogRmFsc2VdIiwgYWN0aW9uPSJzdG9yZV9mYWxzZSIpCgoKYXJncyA9IGFyZ3BhcnNlci5wYXJzZV9hcmdzKCkKCnBvcnQgPSBhcmdzLnBvcnQKcHR5cGUgPSBhcmdzLnR5cGUKb3B0aW9uID0gYXJncy5vcHRpb24KcmVnaW9uID0gYXJncy5yZWdpb24Kc3ViZG9tYWluID0gYXJncy5zdWJkb21haW4KdHVubmVsZXIgPSBhcmdzLnR1bm5lbGVyCmZlc3QgPSBhcmdzLmZlc3QKeXRpZCA9IGFyZ3MueXRpZAp1cmwgPSBhcmdzLnVybApkaXJlY3RvcnkgPSBhcmdzLmRpcmVjdG9yeQpkdXJhdGlvbiA9IGFyZ3MuZHVyYXRpb24KbW9kZSA9IGFyZ3MubW9kZQp0cm91Ymxlc2hvb3QgPSBhcmdzLnRyb3VibGVzaG9vdAprZXkgPSBhcmdzLm5va2V5IGlmIG1vZGUgIT0gInRlc3QiIGVsc2UgRmFsc2UKdXBkYXRlID0gYXJncy5ub3VwZGF0ZQoKbG9jYWxfdXJsID0gZiIxMjcuMC4wLjE6e3BvcnR9IgoKdHNfY29tbWFuZHMgPSB7CiAgICAiY2xvdWRmbGFyZWQiOiBmIntjZl9jb21tYW5kfSB0dW5uZWwgLXVybCB7bG9jYWxfdXJsfSIsCiAgICAibG9jYWx4cG9zZSI6IGYie2x4X2NvbW1hbmR9IHR1bm5lbCBodHRwIC10IHtsb2NhbF91cmx9IiwKICAgICJsb2NhbGhvc3RydW4iOiBmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBsb2NhbGhvc3QucnVuIC1UIC1uIiwKICAgICJzZXJ2ZW8iOiBmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBzZXJ2ZW8ubmV0IC1UIC1uIiwKICAgICJjZiI6IGYie2NmX2NvbW1hbmR9IHR1bm5lbCAtdXJsIHtsb2NhbF91cmx9IiwKICAgICJsb2NseCI6IGYie2x4X2NvbW1hbmR9IHR1bm5lbCBodHRwIC10IHtsb2NhbF91cmx9IiwKICAgICJsaHIiOiBmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBsb2NhbGhvc3QucnVuIC1UIC1uIiwKICAgICJzdm8iOiBmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBzZXJ2ZW8ubmV0IC1UIC1uIgp9CgoKZGVmIGlzX2luc3RhbGxlZChwYWNrYWdlKToKICAgIHJldHVybiBiZ3Rhc2soZiJjb21tYW5kIC12IHtwYWNrYWdlfSIpLndhaXQoKSA9PSAwCgoKZGVmIGlzX3J1bm5pbmcocHJvY2Vzcyk6CiAgICBleGl0X2NvZGUgPSBiZ3Rhc2soZiJwaWRvZiB7cHJvY2Vzc30iKS53YWl0KCkKICAgIGlmIGV4aXRfY29kZSA9PSAwOgogICAgICAgIHJldHVybiBUcnVlCiAgICByZXR1cm4gRmFsc2UKCgoKZGVmIGlzX2pzb24obXlqc29uKToKICAgIHRyeToKICAgICAgICBwYXJzZShteWpzb24pCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gRmFsc2UKCgoKZGVmIGNvcHkocGF0aDEsIHBhdGgyKToKICAgIGlmIGlzZGlyKHBhdGgxKToKICAgICAgICBmb3IgaXRlbSBpbiBsaXN0ZGlyKHBhdGgxKToKICAgICAgICAgICAgb2xkX2ZpbGUgPSBqb2luKHBhdGgxLCBpdGVtKQogICAgICAgICAgICBuZXdfZmlsZSA9IGpvaW4ocGF0aDIsIGl0ZW0pCiAgICAgICAgICAgIGlmIGlzZGlyKG9sZF9maWxlKToKICAgICAgICAgICAgICAgIGNvcHkob2xkX2ZpbGUsIG5ld19maWxlKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbWFrZWRpcnMoZGlybmFtZShuZXdfZmlsZSksIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgICAgICBjb3B5MihvbGRfZmlsZSwgbmV3X2ZpbGUpCiAgICAgICAKICAgIGlmIGlzZmlsZShwYXRoMSk6CiAgICAgICAgaWYgaXNkaXIocGF0aDIpOgogICAgICAgICAgICBjb3B5MihwYXRoMSwgcGF0aDIpCgoKZGVmIGRlbGV0ZSgqcGF0aHMsIHJlY3JlYXRlPUZhbHNlKToKICAgIGZvciBwYXRoIGluIHBhdGhzOgogICAgICAgIGlmIGlzZGlyKHBhdGgpOgogICAgICAgICAgICBpZiByZWNyZWF0ZToKICAgICAgICAgICAgICAgIHJtdHJlZShwYXRoKQogICAgICAgICAgICAgICAgbWtkaXIocGF0aCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJtdHJlZShwYXRoKQogICAgICAgIGlmIGlzZmlsZShwYXRoKTogCiAgICAgICAgICAgIHJlbW92ZShwYXRoKQoKCgpkZWYgY2F0KGZpbGUpOgogICAgaWYgaXNmaWxlKGZpbGUpOgogICAgICAgIHdpdGggb3BlbihmaWxlLCAiciIpIGFzIGZpbGVkYXRhOgogICAgICAgICAgICByZXR1cm4gZmlsZWRhdGEucmVhZCgpCiAgICByZXR1cm4gIiIKCgoKZGVmIHNlZCh0ZXh0MSwgdGV4dDIsIGZpbGVuYW1lMSwgZmlsZW5hbWUyPU5vbmUsIG9jY3VyZW5jZXM9Tm9uZSk6CiAgICBmaWxlZGF0YTEgPSBjYXQoZmlsZW5hbWUxKQogICAgaWYgZmlsZW5hbWUyIGlzIE5vbmU6CiAgICAgICAgZmlsZW5hbWUyID0gZmlsZW5hbWUxCiAgICBpZiBvY2N1cmVuY2VzIGlzIE5vbmU6CiAgICAgICAgZmlsZWRhdGEyID0gZmlsZWRhdGExLnJlcGxhY2UodGV4dDEsIHRleHQyKQogICAgZWxzZToKICAgICAgICBmaWxlZGF0YTIgPSBmaWxlZGF0YTEucmVwbGFjZSh0ZXh0MSwgdGV4dDIsIG9jY3VyZW5jZXMpCiAgICB3cml0ZShmaWxlZGF0YTIsIGZpbGVuYW1lMikKICAgICAgICAKCmRlZiBncmVwKHJlZ2V4LCB0YXJnZXQpOgogICAgaWYgaXNmaWxlKHRhcmdldCk6CiAgICAgICAgY29udGVudCA9IGNhdCh0YXJnZXQpCiAgICBlbHNlOgogICAgICAgIGNvbnRlbnQgPSB0YXJnZXQKICAgIHJlc3VsdHMgPSBzZWFyY2gocmVnZXgsIGNvbnRlbnQpCiAgICBpZiByZXN1bHRzIGlzIG5vdCBOb25lOgogICAgICAgIHJldHVybiByZXN1bHRzLmdyb3VwKDEpCiAgICByZXR1cm4gIiIKCmRlZiB3cml0ZSh0ZXh0LCBmaWxlbmFtZSk6CiAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICJ3IikgYXMgZmlsZToKICAgICAgICBmaWxlLndyaXRlKHN0cih0ZXh0KSsiXG4iKQoKCmRlZiBhcHBlbmQodGV4dCwgZmlsZW5hbWUpOgogICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAiYSIpIGFzIGZpbGU6CiAgICAgICAgZmlsZS53cml0ZShzdHIodGV4dCkrIlxuIikKCmRlZiBnZXRfdmVyKHZlcik6CiAgICByZXR1cm4gaW50KHZlci5yZXBsYWNlKCIuIiwgIiIsIDIpKQoKCmRlZiBzcHJpbnQodGV4dCwgc2Vjb25kPTAuMDUpOgogICAgZm9yIGxpbmUgaW4gdGV4dCArICdcbic6CiAgICAgICAgc3Rkb3V0LndyaXRlKGxpbmUpCiAgICAgICAgc3Rkb3V0LmZsdXNoKCkKICAgICAgICBzbGVlcChzZWNvbmQpCiAgICAgICAgCgpkZWYgbG9sY2F0KHRleHQpOgogICAgaWYgaXNfaW5zdGFsbGVkKCJsb2xjYXQiKToKICAgICAgICBydW4oWyJsb2xjYXQiXSwgaW5wdXQ9dGV4dCwgdGV4dD1UcnVlKQogICAgZWxzZToKICAgICAgICBwcmludCh0ZXh0KQoKCmRlZiBjZW50ZXJfdGV4dCh0ZXh0KToKICAgIGxpbmVzID0gdGV4dC5zcGxpdGxpbmVzKCkKICAgIGlmIGxlbihsaW5lcykgPiAxOgogICAgICAgIG1pbmxlbiA9IG1pbihbbGVuKGxpbmUpIGZvciBsaW5lIGluIGxpbmVzIGlmIGxlbihsaW5lKSE9MF0pICsgOAogICAgICAgIG5ld190ZXh0ID0gIiIKICAgICAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICAgICAgcGFkZGluZyA9IGNvbHVtbnMgKyBsZW4obGluZSkgLSBtaW5sZW4KICAgICAgICAgICAgaWYgY29sdW1ucyAlIDIgPT0gMCBhbmQgcGFkZGluZyAlIDIgPT0gMDoKICAgICAgICAgICAgICAgIHBhZGRpbmcgKz0gMQogICAgICAgICAgICBuZXdfdGV4dCArPSBsaW5lLmNlbnRlcihwYWRkaW5nKSArICJcbiIKICAgICAgICByZXR1cm4gbmV3X3RleHQKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIHRleHQuY2VudGVyKGNvbHVtbnMrOCkKCgoKCmRlZiBzaG93X2ZpbGVfZGF0YShmaWxlKToKICAgIGxpbmVzID0gY2F0KGZpbGUpLnNwbGl0bGluZXMoKQogICAgdGV4dCA9ICIiCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICB0ZXh0ICs9IGYiW2N5YW5dW1svXVtncmVlbl0qWy9dW2N5YW5dXVsvXVt5ZWxsb3ddIHtsaW5lfVsvXVxuIgogICAgY3ByaW50KAogICAgICAgIFBhbmVsKAogICAgICAgICAgICB0ZXh0LnN0cmlwKCksCiAgICAgICAgICAgIHRpdGxlPSJbYm9sZCBncmVlbl1QaGlzaGVyWy9dW2N5YW5dIERhdGFbL10iLCAKICAgICAgICAgICAgdGl0bGVfYWxpZ249ImxlZnQiLAogICAgICAgICAgICBib3JkZXJfc3R5bGU9ImJsdWUiLAogICAgICAgICkKICAgICkKCgpkZWYgdGV4dDJqc29uKHRleHQpOgogICAganNvbiA9IHt9CiAgICBsaW5lcyA9IHRleHQuc3BsaXRsaW5lcygpCiAgICBmb3IgbGluZSBpbiBsaW5lczoKICAgICAgICBpZiAiOiIgaW4gbGluZToKICAgICAgICAgICAga2V5ID0gbGluZS5zcGxpdCgiOiIpWzBdCiAgICAgICAgICAgIHZhbHVlID0gbGluZS5zcGxpdCgiOiIpWzFdCiAgICAgICAgICAgIGZvciBfIGluIGxpbmU6CiAgICAgICAgICAgICAgICBqc29uW2tleS5zdHJpcCgpXSA9IHZhbHVlLnN0cmlwKCkKICAgIHJldHVybiBqc29uCgoKZGVmIGFkZF9qc29uKGpzb24sIGZpbGVuYW1lKToKICAgIGNvbnRlbnQgPSBjYXQoZmlsZW5hbWUpCiAgICBpZiBpc19qc29uKGNvbnRlbnQpIG9yIGNvbnRlbnQgPT0gIiI6CiAgICAgICAgaWYgY29udGVudCA9PSAiIjoKICAgICAgICAgICAgbmV3X2NvbnRlbnQgPSBbXQogICAgICAgIGlmIGlzX2pzb24oY29udGVudCk6CiAgICAgICAgICAgIG5ld19jb250ZW50ID0gcGFyc2UoY29udGVudCkKICAgICAgICBpZiBpc2luc3RhbmNlKG5ld19jb250ZW50LCBsaXN0KToKICAgICAgICAgICAgbmV3X2NvbnRlbnQuYXBwZW5kKGpzb24pCiAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZ2lmeShuZXdfY29udGVudCwgaW5kZW50PTIpCiAgICAgICAgICAgIHdyaXRlKHN0cmluZywgZmlsZW5hbWUpCiAgICAgICAgICAgIAoKCmRlZiBzaGVsbChjb21tYW5kLCBjYXB0dXJlX291dHB1dD1GYWxzZSk6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIHJ1bihjb21tYW5kLCBzaGVsbD1UcnVlLCBjYXB0dXJlX291dHB1dD1jYXB0dXJlX291dHB1dCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhcHBlbmQoZSwgZXJyb3JfZmlsZSkKCmRlZiBiZ3Rhc2soY29tbWFuZCwgc3Rkb3V0PVBJUEUsIHN0ZGVycj1ERVZOVUxMLCBjd2Q9Ii4vIik6CiAgICB0cnk6CiAgICAgICAgcmV0dXJuIFBvcGVuKGNvbW1hbmQsIHNoZWxsPVRydWUsIHN0ZG91dD1zdGRvdXQsIHN0ZGVycj1zdGRlcnIsIGN3ZD1jd2QpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCgoKZGVmIGdldF9tZXRhKHVybCk6CiAgCiAgICBoZWFkZXJzID0gewogICAgICAgICJ1c2VyLWFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCA4LjEuMCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwMi4wLjUwMDUuOTkgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgImFjY2VwdCI6ICJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqW2luc2VydGVkIGJ5IGN5dGhvbiB0byBhdm9pZCBjb21tZW50IGNsb3Nlcl0vW2luc2VydGVkIGJ5IGN5dGhvbiB0byBhdm9pZCBjb21tZW50IHN0YXJ0XSo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjkiLAogICAgICAgICJhY2NlcHQtbGFuZ3VhZ2UiOiAiZW4tR0IsZW4tVVM7cT0wLjksZW47cT0wLjgiCiAgICB9CiAgICBpZiAiZmFjZWJvb2siIGluIHVybDoKICAgICAgICBoZWFkZXJzLnVwZGF0ZSh7CiAgICAgICAgICAgICJ1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIjogIjEiLAogICAgICAgICAgICAiZG50IjogIjEiLCAKICAgICAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybC1lbmNvZGVkIiwKICAgICAgICAgICAgIm9yaWdpbiI6ICJodHRwczovL20uZmFjZWJvb2suY29tIiwKICAgICAgICAgICAgInJlZmVyZXIiOiAiaHR0cHM6Ly9tLmZhY2Vib29rLmNvbS8iLCAKICAgICAgICAgICAgInNlYy1mZXRjaC1zaXRlIjogInNhbWUtb3JpZ2luIiwKICAgICAgICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLCAKICAgICAgICAgICAgInNlYy1mZXRjaC11c2VyIjogImVtcHR5IiwgCiAgICAgICAgICAgICJzZWMtZmV0Y2gtZGVzdCI6ICJkb2N1bWVudCIsIAogICAgICAgICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogIkFuZHJvaWQiLAogICAgICAgICAgICAiYWNjZXB0LWVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUgYnIiCiAgICAgICAgfSkKICAgIGFsbG1ldGEgPSAiIgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0gZ2V0KHVybCwgaGVhZGVycz1oZWFkZXJzKS50ZXh0CiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAocmVzcG9uc2UsICJodG1sLnBhcnNlciIpCiAgICAgICAgbWV0YXMgPSBzb3VwLmZpbmRfYWxsKCJtZXRhIikKICAgICAgICBpZiBtZXRhcyBpcyBub3QgTm9uZSBhbmQgbWV0YXMhPVtdOgogICAgICAgICAgICBhbGxtZXRhID0gIlxuIi5qb2luKFtzdHIobWV0YSkgZm9yIG1ldGEgaW4gbWV0YXNdKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGFwcGVuZChlLCBlcnJvcl9maWxlKQogICAgcmV0dXJuIGFsbG1ldGEKICAgIAoKZGVmIGV4Y2VwdGlvbl9oYW5kbGVyKGUpOgogICAgbGluZXNfYXJyID0gW10KICAgIHRiID0gZS5fX3RyYWNlYmFja19fCiAgICB3aGlsZSB0YiBpcyBub3QgTm9uZToKICAgICAgICBpZiB0Yi50Yl9mcmFtZS5mX2NvZGUuY29fZmlsZW5hbWUgPT0gYWJzcGF0aChfX2ZpbGVfXyk6CiAgICAgICAgICAgIGxpbmVzX2Fyci5hcHBlbmQoc3RyKHRiLnRiX2xpbmVubykpCiAgICAgICAgdGIgPSB0Yi50Yl9uZXh0CiAgICBuYW1lID0gdHlwZShlKS5fX25hbWVfXwogICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCiAgICBpZiAiOiIgaW4gc3RyKGUpOgogICAgICAgIG1lc3NhZ2UgPSBzdHIoZSkuc3BsaXQoIjoiKVswXQogICAgZWxpZiAiKCIgaW4gc3RyKGUpOgogICAgICAgIG1lc3NhZ2UgPSBzdHIoZSkuc3BsaXQoIigiKVswXQogICAgZWxzZToKICAgICAgICBtZXNzYWdlID0gc3RyKGUpCiAgICBsaW5lX25vID0gbGluZXNfYXJyW2xlbihsaW5lc19hcnIpIC0gMV0KICAgIGxpbmVzX25vID0gIiwgIi5qb2luKGxpbmVzX2FycikKICAgIHByaW50KGYie2Vycm9yfXtuYW1lfToge21lc3NhZ2V9IGF0IGxpbmVzIHtsaW5lc19ub30iKQogICAgCiNpZiBzaGEyNTYobG9nby5lbmNvZGUoInV0Zi04IikpLmhleGRpZ2VzdCgpICE9ICIxMDE0OTBiNmE3NDVjZTFhYTU2YzQxZjQ3N2I1NGZhYzVmM2ZkZGRhNzk4MTA1ZTFhNjA5MGZiOGViNTJmZGZiIjoKICMgICBwcmludChmIntpbmZvfVZpc2l0OiB7cmVwb191cmx9IikKICAjICBiZ3Rhc2soZiJ4ZGctb3BlbiB7cmVwb191cmx9IikKICAgIyBkZWxldGUoX19maWxlX18pCiAgICAjZXhpdCgxKQogICAKCmRlZiBzaG93X29wdGlvbnMoc2l0ZXMsIGlzX21haW49VHJ1ZSwgaXNfbG9naW49RmFsc2UpOgogICAgdG90YWxfc2l0ZXMgPSBsZW4oc2l0ZXMpCiAgICBkZWYgb3B0aW9uZXIoaW5kZXgsIG1heF9sZW4pOgogICAgICAgICMgQXZvaWQgUmFuZ2VFcnJvci9JbmRleEVycm9yCiAgICAgICAgaWYgaW5kZXggPj0gdG90YWxfc2l0ZXM6CiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgICMgQWRkIDAgYmVmb3JlIHNpbmdsZSBkaWdpdCBudW1iZXIKICAgICAgICBuZXdfaW5kZXggPSBzdHIoaW5kZXgrMSkgaWYgaW5kZXggPj0gOSBlbHNlICIwIitzdHIoaW5kZXgrMSkgCiAgICAgICAgIyBUbyBmdWxsZmlsbCBtYXggbGVuZ3RoIG9mIGEgcGFydCB3ZSBhcHBlbmQgZW1wdHkgc3BhY2UKICAgICAgICBzcGFjZSA9ICIgIiAqIChtYXhfbGVuIC0gbGVuKHNpdGVzW2luZGV4XSkpCiAgICAgICAgcmV0dXJuIGYie2dyZWVufVt7d2hpdGV9e25ld19pbmRleH17Z3JlZW59XSB7eWVsbG93fXtzaXRlc1tpbmRleF19e3NwYWNlfSIKICAgICMgQXJyYXkgaW5kZXggc3RhcnRzIGZyb20gMAogICAgZmlyc3RfaW5kZXggPSAwCiAgICAjIFRocmVlIGNvbHVtbnMKICAgIG9uZV90aGlyZCA9IGludCh0b3RhbF9zaXRlcy8zKQogICAgIyBJZiB0aGVyZSBpcyBtb2R1bHVzLCB0aGF0IG1lYW5zIHNvbWUgZW50cmllcyBhcmUgcmVtYWluaW5nLCB3ZSBuZWVkIGFuIGV4dHJhIHJvdwogICAgaWYgdG90YWxfc2l0ZXMlMyA+IDA6CiAgICAgICAgb25lX3RoaXJkICs9IDEKICAgIG9wdGlvbnMgPSAiXG5cbiIKICAgICMgRmlyc3QgaW5kZXggb2YgbGFzdCBsaW5lIHNob3VsZCBiZSBsZXNzIHRoYW4gb25lLXRoaXJkIG9mIHRvdGFsCiAgICB3aGlsZSBmaXJzdF9pbmRleCA8IG9uZV90aGlyZCBhbmQgdG90YWxfc2l0ZXMgPiAxMDoKICAgICAgICBzZWNvbmRfaW5kZXggPSBmaXJzdF9pbmRleCArIG9uZV90aGlyZAogICAgICAgIHRoaXJkX2luZGV4ID0gc2Vjb25kX2luZGV4ICsgb25lX3RoaXJkCiAgICAgICAgb3B0aW9ucyArPSBvcHRpb25lcihmaXJzdF9pbmRleCwgMjMpICsgb3B0aW9uZXIoc2Vjb25kX2luZGV4LCAxNykgKyBvcHRpb25lcih0aGlyZF9pbmRleCwgMSkgKyAiXG4iCiAgICAgICAgZmlyc3RfaW5kZXggKz0gMQogICAgaWYgdG90YWxfc2l0ZXMgPCAxMDoKICAgICAgICBmb3IgaSBpbiByYW5nZSh0b3RhbF9zaXRlcyk6CiAgICAgICAgICAgIG9wdGlvbnMgKz0gb3B0aW9uZXIoaSwgMjApICsgIlxuIgogICAgb3B0aW9ucyArPSAiXG4iCiAgICBpZiBpc19tYWluOgogICAgICAgIG9wdGlvbnMgKz0gZiJ7Z3JlZW59W3tncmVlbn1he2dyZWVufV17Z3JlZW59IEFib3V0ICAgICB7Z3JlZW59W3tncmVlbn1ve2dyZWVufV17Z3JlZW59IEFkZFppcCAge2dyZWVufSAgICAgICB7Z3JlZW59W3tncmVlbn1te2dyZWVufV17Z3JlZW59IE1vcmUgdG9vbHMgICAgIHtncmVlbn1be2dyZWVufTB7Z3JlZW59XXtncmVlbn0gRXhpdFxuXG4iCiAgICBlbHNlOgogICAgICAgIGlmIGlzX2xvZ2luIGFuZCBpc2ZpbGUoc2F2ZWRfZmlsZSkgYW5kIGNhdChzYXZlZF9maWxlKSE9IiI6CiAgICAgICAgICAgIG9wdGlvbnMgKz0gZiJ7Z3JlZW59W3t3aGl0ZX1he2dyZWVufV17eWVsbG93fSBBYm91dCAgICAgIHtncmVlbn1be3doaXRlfXN7Z3JlZW59XXt5ZWxsb3d9IFNhdmVkICAgICAge2dyZWVufVt7d2hpdGV9eHtncmVlbn1de3llbGxvd30gTWFpbiBNZW51ICAgICAgIHtncmVlbn1be3doaXRlfTB7Z3JlZW59XXt5ZWxsb3d9IEV4aXRcblxuIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG9wdGlvbnMgKz0gZiJ7Z3JlZW59W3t3aGl0ZX1he2dyZWVufV17eWVsbG93fSBBYm91dCAgICAgICAgICAgICAgICAgICB7Z3JlZW59W3t3aGl0ZX14e2dyZWVufV17eWVsbG93fSBNYWluIE1lbnUgICAgICAgICB7Z3JlZW59W3t3aGl0ZX0we2dyZWVufV17eWVsbG93fSBFeGl0XG5cbiIKICAgIGxvbGNhdChvcHRpb25zKQojIENsZWFyIHRoZSBzY3JlZW4gYW5kIHNob3cgbG9nbwpkZWYgY2xlYXIoZmFzdD1GYWxzZSwgbG9sPUZhbHNlKToKICAgIHNoZWxsKCJjbGVhciIpCiAgICBpZiBmYXN0OgogICAgICAgIHByaW50KGxvZ28pCiAgICBlbGlmIGxvbDoKICAgICAgICBsb2xjYXQobG9nbykKICAgIGVsc2U6CiAgICAgICAgc3ByaW50KGxvZ28sIDAuMDEpCiAgICAgICAgCiAgICAgICAgCgojIEluc3RhbGwgcGFja2FnZXMKZGVmIGluc3RhbGxlcihwYWNrYWdlLCBwYWNrYWdlX25hbWU9Tm9uZSk6CiAgICBpZiBwYWNrYWdlX25hbWUgaXMgTm9uZToKICAgICAgICBwYWNrYWdlX25hbWUgPSBwYWNrYWdlCiAgICBmb3IgcGFjbWFuIGluIFsicGtnIiwgImFwdCIsICJhcHQtZ2V0IiwgImFwayIsICJ5dW0iLCAiZG5mIiwgImJyZXciLCAicGFjbWFuIl06CiAgICAgICAgIyBDaGVjayBpZiBwYWNrYWdlIG1hbmFnZXIgaXMgcHJlc2VudCBidXQgcGhwIGlzbid0IHByZXNlbnQKICAgICAgICBpZiBpc19pbnN0YWxsZWQocGFjbWFuKToKICAgICAgICAgICAgaWYgbm90IGlzX2luc3RhbGxlZChwYWNrYWdlKToKICAgICAgICAgICAgICAgIHNwcmludChmIlxue2luZm99SW5zdGFsbGluZyB7cGFja2FnZX17bmN9IikKICAgICAgICAgICAgICAgIGlmIHBhY21hbj09InBhY21hbiI6CiAgICAgICAgICAgICAgICAgICAgc2hlbGwoZiJzdWRvIHtwYWNtYW59IC1TIHtwYWNrYWdlX25hbWV9IC0tbm9jb25maXJtIikKICAgICAgICAgICAgICAgIGVsaWYgcGFjbWFuPT0iYXBrIjoKICAgICAgICAgICAgICAgICAgICBpZiBpc19pbnN0YWxsZWQoInN1ZG8iKToKICAgICAgICAgICAgICAgICAgICAgICAgc2hlbGwoZiJzdWRvIHtwYWNtYW59IGFkZCB7cGFja2FnZV9uYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2hlbGwoZiJ7cGFjbWFufSBhZGQgLXkge3BhY2thZ2VfbmFtZX0iKQogICAgICAgICAgICAgICAgZWxpZiBpc19pbnN0YWxsZWQoInN1ZG8iKToKICAgICAgICAgICAgICAgICAgICBzaGVsbChmInN1ZG8ge3BhY21hbn0gaW5zdGFsbCAteSB7cGFja2FnZV9uYW1lfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNoZWxsKGYie3BhY21hbn0gaW5zdGFsbCAteSB7cGFja2FnZV9uYW1lfSIpCiAgICAgICAgICAgICAgICBicmVhawogICAgaWYgaXNfaW5zdGFsbGVkKCJicmV3Iik6CiAgICAgICAgaWYgbm90IGlzX2luc3RhbGxlZCgiY2xvdWRmbGFyZSIpOgogICAgICAgICAgICBzaGVsbCgiYnJldyBpbnN0YWxsIGNsb3VkZmxhcmUvY2xvdWRmbGFyZS9jbG91ZGZsYXJlZCIpCiAgICAgICAgaWYgbm90IGlzX2luc3RhbGxlZCgibG9jYWx4cG9zZSIpOgogICAgICAgICAgICBzaGVsbCgiYnJldyBpbnN0YWxsIGxvY2FseHBvc2UiKQoKCiMgUHJvY2VzcyBraWxsZXIKZGVmIGtpbGxlcigpOgogICAgIyBQcmV2aW91cyBpbnN0YW5jZXMgb2YgdGhlc2Ugc2hvdWxkIGJlIHN0b3BwZWQKICAgIGZvciBwcm9jZXNzIGluIHByb2Nlc3NlczoKICAgICAgICBpZiBpc19ydW5uaW5nKHByb2Nlc3MpOgogICAgICAgICAgICAjIHN5c3RlbShmImtpbGxhbGwge3Byb2Nlc3N9IikKICAgICAgICAgICAgb3V0cHV0ID0gc2hlbGwoZiJwaWRvZiB7cHJvY2Vzc30iLCBUcnVlKS5zdGRvdXQuZGVjb2RlKCJ1dGYtOCIpLnN0cmlwKCkKICAgICAgICAgICAgaWYgIiAiIGluIG91dHB1dDoKICAgICAgICAgICAgICAgIGZvciBwaWQgaW4gb3V0cHV0LnNwbGl0KCIgIik6CiAgICAgICAgICAgICAgICAgICAga2lsbChpbnQocGlkKSwgU0lHSU5UKQogICAgICAgICAgICBlbGlmIG91dHB1dCAhPSAiIjoKICAgICAgICAgICAgICAgIGtpbGwoaW50KG91dHB1dCksIFNJR0lOVCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCkKCgojIEludGVybmV0IENoZWNrZXIKCmRlZiBpbnRlcm5ldCh1cmw9Imh0dHBzOi8vYXBpLmdpdGh1Yi5jb20iLCB0aW1lb3V0PTUpOgogICAgd2hpbGUgdXBkYXRlOgogICAgICAgIHRyeToKICAgICAgICAgICAgaGVhZCh1cmw9dXJsLCB0aW1lb3V0PXRpbWVvdXQpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0IENvbm5lY3Rpb25FcnJvcjoKICAgICAgICAgICAgcHJpbnQoZiJcbntlcnJvcn1ObyBpbnRlcm5ldCF7bmN9XDAwNyIpCiAgICAgICAgICAgIHNsZWVwKDIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIntlcnJvcn17c3RyKGUpfSIpCiAgICAgICAgCiMgU2VuZCBtYWlsIGJ5IHNtdHAgbGlicmFyeQpkZWYgc2VuZF9tYWlsKG1zZyk6CiAgICBnbG9iYWwgZW1haWwsIHBhc3N3b3JkLCByZWNlaXZlcgogICAgbWVzc2FnZSA9IGYiRnJvbToge2VtYWlsfVxuVG86IHtyZWNlaXZlcn1cblN1YmplY3Q6IFx4NGRceDYxXHg3OFx4NTBceDY4XHg2OVx4NzNceDY4XHg2NVx4NzIgTG9naW4gQ3JlZGVudGlhbHNcblxue21zZ30iCiAgICB0cnk6CiAgICAgICAgaW50ZXJuZXQoKQogICAgICAgIHdpdGggc210cCgnc210cC5nbWFpbC5jb20nLCA0NjUpIGFzIHNlcnZlcjoKICAgICAgICAgICAgc2VydmVyLmxvZ2luKGVtYWlsLCBwYXNzd29yZCkKICAgICAgICAgICAgc2VydmVyLnNlbmRtYWlsKGVtYWlsLCByZWNlaXZlciwgbWVzc2FnZSkgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCiAgICAgICAgcHJpbnQoZiJ7ZXJyb3J9e3N0cihlKX0iKQoKIyBCeXRlcyB0byBLQiwgTUIgY29udmVydGVyCmRlZiByZWFkYWJsZShieXRlLCBwcmVjaXNpb24gPSAyLCBpc19zcGVlZCA9IEZhbHNlKToKICAgIGZvciB1bml0IGluIFsiQnQiLCJLQiIsIk1CIiwiR0IiXToKICAgICAgICBmbG9hdGJ5dGUgPSByb3VuZChieXRlLCBwcmVjaXNpb24pCiAgICAgICAgc3BhY2UgPSAnICcgKiAoNiAtIGxlbihzdHIoZmxvYXRieXRlKSkpCiAgICAgICAgaWYgYnl0ZSA8IDEwMjQuMDoKICAgICAgICAgICAgaWYgaXNfc3BlZWQ6CiAgICAgICAgICAgICAgICBzaXplID0gZiJ7ZmxvYXRieXRlfSB7dW5pdH0vc3tzcGFjZX0iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzaXplID0gZiJ7ZmxvYXRieXRlfSB7dW5pdH17c3BhY2V9IgogICAgICAgICAgICBicmVhawogICAgICAgIGJ5dGUgLz0gMTAyNC4wCiAgICByZXR1cm4gc2l6ZQoKIyBEb3dubG9hZCBmaWxlcyB3aXRoIHByb2dyZXNzIGJhcgpkZWYgZG93bmxvYWQodXJsLCBwYXRoKToKICAgIGZyb20gdGltZSBpbXBvcnQgY3RpbWUsIHRpbWUKICAgIHNlc3Npb24gPSBTZXNzaW9uKCkKICAgIGZpbGVuYW1lID0gYmFzZW5hbWUocGF0aCkKICAgIGRpcmVjdG9yeSA9IGRpcm5hbWUocGF0aCkKICAgIHJldHJ5ID0gMwogICAgaWYgZGlyZWN0b3J5IT0iIiBhbmQgbm90IGlzZGlyKGRpcmVjdG9yeSk6CiAgICAgICAgbWtkaXIoZGlyZWN0b3J5KQogICAgbmV3ZmlsZSA9IGZpbGVuYW1lLnNwbGl0KCIuIilbMF0gaWYgIi4iIGluIGZpbGVuYW1lIGVsc2UgZmlsZW5hbWUKICAgIG5ld25hbWUgPSBmaWxlbmFtZSBpZiBsZW4oZmlsZW5hbWUpIDw9IDEyIGVsc2UgZmlsZW5hbWVbOjldKyIuLi4iCiAgICBmb3IgaSBpbiByYW5nZShyZXRyeSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludCgpCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAid2IiKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZXNzaW9uLmdldCh1cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PTIwKQogICAgICAgICAgICAgICAgdG90YWxfbGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJykKICAgICAgICAgICAgICAgIGlmIHRvdGFsX2xlbmd0aCBpcyBOb25lOiAjIG5vIGNvbnRlbnQgbGVuZ3RoIGhlYWRlcgogICAgICAgICAgICAgICAgICAgIGZpbGUud3JpdGUocmVzcG9uc2UuY29udGVudCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdG90YWxfbGVuZ3RoID0gaW50KHRvdGFsX2xlbmd0aCkKICAgICAgICAgICAgICAgICAgICB3aXRoIFByb2dyZXNzKAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0Q29sdW1uKCJbYm9sZCBibHVlXXt0YXNrLmZpZWxkc1tmaWxlbmFtZV19IiwganVzdGlmeT0icmlnaHQiKSwKICAgICAgICAgICAgICAgICAgICAgICAgQmFyQ29sdW1uKGJhcl93aWR0aD1Ob25lKSwKICAgICAgICAgICAgICAgICAgICAgICAgIltwcm9ncmVzcy5wZXJjZW50YWdlXXt0YXNrLnBlcmNlbnRhZ2U6PjMuMWZ9JSIsCiAgICAgICAgICAgICAgICAgICAgICAgICLigKIiLAogICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2ZlclNwZWVkQ29sdW1uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICLigKIiLAogICAgICAgICAgICAgICAgICAgICAgICBUaW1lUmVtYWluaW5nQ29sdW1uKCkKICAgICAgICAgICAgICAgICAgICApIGFzIHByb2dyZXNzOgogICAgICAgICAgICAgICAgICAgICAgICB0YXNrID0gcHJvZ3Jlc3MuYWRkX3Rhc2sobmV3ZmlsZSwgdG90YWw9dG90YWxfbGVuZ3RoLCBmaWxlbmFtZT1uZXdmaWxlLnRpdGxlKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBkYXRhIGluIHJlc3BvbnNlLml0ZXJfY29udGVudChjaHVua19zaXplPTQwOTYpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShkYXRhKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKHRhc2ssIGFkdmFuY2U9bGVuKGRhdGEpKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJlbW92ZShwYXRoKQogICAgICAgICAgICBhcHBlbmQoZSwgZXJyb3JfZmlsZSkKICAgICAgICAgICAgcHJpbnQoZiJcbntlcnJvcn1Eb3dubG9hZCBmYWlsZWQgZHVlIHRvOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHByaW50KGYiXG57aW5mb31SZXRyeWluZyB7aX0ve3JldHJ5fXtuY30iKQogICAgICAgICAgICBzbGVlcCgxKQogICAgaWYgbm90IGlzZmlsZShwYXRoKToKICAgICAgICBwcmludChmIlxue2Vycm9yfURvd25sb2FkIGZhaWxlZCBwZXJtYW5lbnRseSEiKQogICAgICAgIHBleGl0KCkKCgojIEV4dHJhY3QgemlwL3Rhci90Z3ogZmlsZXMKZGVmIGV4dHJhY3QoZmlsZW5hbWUsIGV4dHJhY3RfcGF0aD0nLicsIHB3ZD1Ob25lKToKICAgIGRpcmVjdG9yeSA9IGRpcm5hbWUoZXh0cmFjdF9wYXRoKQogICAgbmV3ZmlsZSA9IGZpbGVuYW1lLnNwbGl0KCIuIilbMF0gaWYgIi4iIGluIGZpbGVuYW1lIGVsc2UgZmlsZW5hbWUKICAgIGlmIGRpcmVjdG9yeSE9IiIgYW5kIG5vdCBpc2RpcihkaXJlY3RvcnkpOgogICAgICAgIG1rZGlyKGRpcmVjdG9yeSkKICAgIHByaW50KGYiXG57aW5mb31FeHRyYWN0aW5nIHtncmVlbn17bmV3ZmlsZS50aXRsZSgpfXtuY30uLi5cbiIpCiAgICB0cnk6CiAgICAgICAgaWYgIi56aXAiIGluIGZpbGVuYW1lOgogICAgICAgICAgICB3aXRoIFppcEZpbGUoZmlsZW5hbWUsICdyJykgYXMgemlwX3JlZjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBwd2QgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgemlwX3JlZi5leHRyYWN0YWxsKGV4dHJhY3RfcGF0aCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aXBfcmVmLmV4dHJhY3RhbGwoZXh0cmFjdF9wYXRoLCBwd2Q9Ynl0ZXMocHdkLCAidXRmLTgiKSkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntlcnJvcn1Xcm9uZyBwYXNzd29yZCEiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntlcnJvcn1aaXAgZmlsZSBjb3JydXB0ZWQhIikKICAgICAgICAgICAgICAgICAgICBkZWxldGUoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIHRhciA9IHRhcm9wZW4oZmlsZW5hbWUsICdyJykKICAgICAgICBmb3IgaXRlbSBpbiB0YXI6CiAgICAgICAgICAgIHRhci5leHRyYWN0KGl0ZW0sIGV4dHJhY3RfcGF0aCkKICAgICAgICAgICAgIyBSZWN1cnNpb24gaWYgY2hpbGRzIGFyZSB0YXJmaWxlCiAgICAgICAgICAgIGlmICIudGd6IiBpbiBpdGVtLm5hbWUgb3IgIi50YXIiIGluIGl0ZW0ubmFtZToKICAgICAgICAgICAgICAgIGV4dHJhY3QoaXRlbS5uYW1lLCAiLi8iICsgaXRlbS5uYW1lWzppdGVtLm5hbWUucmZpbmQoJy8nKV0pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCiAgICAgICAgZGVsZXRlKGZpbGVuYW1lKQogICAgICAgIHByaW50KGYie2Vycm9yfXtzdHIoZSl9IikKICAgICAgICBleGl0KDEpCiAgICAgICAgCgpkZWYgZ2V0X21lZGlhKCk6CiAgICBleHRlbnNpb25fZmlsdGVyID0gbGFtYmRhIGZpbGVuYW1lOiBmaWxlbmFtZS5zcGxpdCgnLicpWy0xXSBpbiBleHRlbnNpb25zCiAgICBtZWRpYV9maWxlcyA9IFtdCiAgICBmb3IgZmlsZW5hbWUgaW4gZmlsdGVyKGV4dGVuc2lvbl9maWx0ZXIsIGxpc3RkaXIoc2l0ZV9kaXIpKToKICAgICAgICBpZiBmaWxlbmFtZSBub3QgaW4gWyJkZXNjLnBuZyIsICJray5qcGciXToKICAgICAgICAgICAgbWVkaWFfZmlsZXMuYXBwZW5kKGYie3NpdGVfZGlyfS97ZmlsZW5hbWV9IikKICAgIHJldHVybiBtZWRpYV9maWxlcwoKZGVmIHdyaXRlX21ldGEodXJsKToKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgdXJsIGlzIE5vbmUgb3IgdXJsID09ICIiOgogICAgICAgICAgICBtZXRhdXJsID0gaW5wdXQoZiJcbnthc2t9e2JjeWFufUVudGVyIHNoYWRvdyB1cmwge2dyZWVufSh7Ymx1ZX1mb3Igc29jaWFsIG1lZGlhIHByZXZpZXd7Z3JlZW59KXtiY3lhbn1be3JlZH1wcmVzcyBlbnRlciB0byBza2lwe2JjeWFufV0gOiB7Z3JlZW59IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBtZXRhdXJsID0gdXJsCiAgICAgICAgaWYgbWV0YXVybD09IiI6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxpZiBtZXRhdXJsID09ICJoZWxwIjoKICAgICAgICAgICAgc3ByaW50KHNoYWRvd19oZWxwKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFsbG1ldGEgPSBnZXRfbWV0YShtZXRhdXJsKQogICAgICAgICAgICBpZiBhbGxtZXRhPT0iIjoKICAgICAgICAgICAgICAgIHByaW50KGYiXG57ZXJyb3J9Tm8gcHJldmlldyBnZW5lcmF0ZWQgZnJvbSBzcGVjaWZpZWQgVVJMISIpCiAgICAgICAgICAgIHdyaXRlKGFsbG1ldGEsIGYie3NpdGVfZGlyfS9tZXRhLnBocCIpCiAgICAgICAgICAgIGJyZWFrCgoKZGVmIHdyaXRlX3JlZGlyZWN0KCk6CiAgICBnbG9iYWwgdXJsLCByZWRpcl91cmwKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgdXJsIGlzIE5vbmUgb3IgdXJsID09ICIiOgogICAgICAgICAgICByZWRpcmVjdF91cmwgPSBpbnB1dChmIlxue2Fza317YmN5YW59RW50ZXIgcmVkaXJlY3Rpb24gdXJse2JjeWFufVt7cmVkfXByZXNzIGVudGVyIHRvIHNraXB7YmN5YW59XSA6IHtncmVlbn0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlZGlyZWN0X3VybCA9IHVybAogICAgICAgIGlmIHJlZGlyZWN0X3VybCBpcyBOb25lIG9yIHJlZGlyZWN0X3VybCA9PSAiIjoKICAgICAgICAgICAgcmVkaXJlY3RfdXJsID0gcmVkaXJfdXJsCiAgICAgICAgICAgIHNlZCgicmVkaXJlY3RVcmwiLCByZWRpcmVjdF91cmwsIGYie3NpdGVfZGlyfS9sb2dpbi5waHAiKQogICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlZCgicmVkaXJlY3RVcmwiLCByZWRpcmVjdF91cmwsIGYie3NpdGVfZGlyfS9sb2dpbi5waHAiKQogICAgICAgICAgICBicmVhawogICAgICAgIGlmIHJlZGlyZWN0X3VybCA9PSAiaGVscCI6CiAgICAgICAgICAgIHNwcmludChzaGFkb3dfaGVscCkKCiMgUG9saXRlIEV4aXQKZGVmIHBleGl0KCk6CiAgICBraWxsZXIoKQogICAgc3ByaW50KGYiXG57aW5mbzJ9VGhhbmtzIGZvciB1c2luZyFcbntuY30iKQogICAgZXhpdCgwKQoKCiMgU2V0IHVwIGxvY2x4IGF1dGh0b2tlbiB0byB3b3JrIHdpdGggbG9jbHggbGlua3MKZGVmIGx4X3Rva2VuKCk6CiAgICBnbG9iYWwgbHhfY29tbWFuZAogICAgd2hpbGUgVHJ1ZToKICAgICAgICBzdGF0dXMgPSBzaGVsbChmIntseF9jb21tYW5kfSBhY2NvdW50IHN0YXR1cyIsIFRydWUpLnN0ZG91dC5kZWNvZGUoInV0Zi04Iikuc3RyaXAoKS5sb3dlcigpCiAgICAgICAgaWYgbm90ICJlcnJvciIgaW4gc3RhdHVzOgogICAgICAgICAgICBicmVhawogICAgICAgIGhhc190b2tlbiA9IGlucHV0KGYiXG57YXNrfURvIHlvdSBoYXZlIGxvY2x4IGFjY2VzcyB0b2tlbj8gW3kvTi9oZWxwXToge2dyZWVufSIpCiAgICAgICAgaWYgaGFzX3Rva2VuID09ICJ5IjoKICAgICAgICAgICAgc2hlbGwoZiJ7bHhfY29tbWFuZH0gYWNjb3VudCBsb2dpbiIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxpZiBoYXNfdG9rZW4gPT0gImhlbHAiOgogICAgICAgICAgICBzcHJpbnQobHhfaGVscCwgMC4wMSkKICAgICAgICAgICAgc2xlZXAoMykKICAgICAgICBlbGlmIGhhc190b2tlbiBpbiBbIm4iLCAiIl06CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntlcnJvcn1JbnZhbGlkIGlucHV0ICd7aGFzX3Rva2VufSchIikKICAgICAgICAgICAgc2xlZXAoMSkKCgpkZWYgc3NoX2tleSgpOgogICAgaWYga2V5IGFuZCBub3QgaXNmaWxlKGYie3NzaF9kaXJ9L2lkX3JzYSIpOgogICAgICAgIGlzX25vX3Bhc3MgPSBiZ3Rhc2soZiJzc2gta2V5Z2VuIC15IC1QICcnIC1mIHtzc2hfZGlyfS9pZF9yc2EiKS53YWl0KCkKICAgICAgICBpZiBpc19ub19wYXNzICE9IDA6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgIyBkZWxldGUoc3NoX2RpcikKICAgICAgICBwcmludChuYykKICAgICAgICBzaGVsbChmIm1rZGlyIC1wIHtzc2hfZGlyfSAmJiBzc2gta2V5Z2VuIC1OICcnIC10IHJzYSAtZiB7c3NoX2Rpcn0vaWRfcnNhIikKICAgIGlzX2tub3duID0gYmd0YXNrKCJzc2gta2V5Z2VuIC1GIGxvY2FsaG9zdC5ydW4iKS53YWl0KCkKICAgIGlmIGlzX2tub3duICE9IDA6CiAgICAgICAgc2hlbGwoZiJzc2gta2V5c2NhbiAtSCBsb2NhbGhvc3QucnVuID4+IHtzc2hfZGlyfS9rbm93bl9ob3N0cyIsIFRydWUpCiAgICBpc19rbm93bjIgPSBiZ3Rhc2soInNzaC1rZXlnZW4gLUYgc2VydmVvLm5ldCIpLndhaXQoKQogICAgaWYgaXNfa25vd24yICE9IDA6CiAgICAgICAgc2hlbGwoZiJzc2gta2V5c2NhbiAtSCBzZXJ2ZW8ubmV0ID4+IHtzc2hfZGlyfS9rbm93bl9ob3N0cyIsIFRydWUpCgojIEFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiBmb3IgbG9naW4gcGhpc2hpbmcKZGVmIHNldF9sb2dpbigpOgogICAgd3JpdGVfbWV0YShOb25lKQogICAgd3JpdGVfcmVkaXJlY3QoKQoKIyBBZGRpdGlvbmFsIGNvbmZpZ3VyYXRpb24gZm9yIGltYWdlIHBoaXNoaW5nCmRlZiBzZXRfaW1hZ2UoKToKICAgIGdsb2JhbCBmZXN0LCB5dGlkCiAgICBzZWQoImZlc3ROYW1lIiwgZmVzdCwgZiJ7c2l0ZV9kaXJ9L2luZGV4Lmh0bWwucGhwIikKICAgIHl0aWQgPSBzdWIoIihbLyUrJj89e30gXSkiLCAiIiwgeXRpZCkKICAgIHNlZCgieXRJZCIsIHl0aWQsIGYie3NpdGVfZGlyfS9pbmRleC5odG1sLnBocCIpCgojIEFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiBmb3IgdmlkZW8gcGhpc2hpbmcKZGVmIHNldF9kdXJhdGlvbigpOgogICAgZ2xvYmFsIGR1cmF0aW9uCiAgICByZWNvcmRpbmdUaW1lID0gc3RyKGR1cmF0aW9uKQogICAgc2VkKCJyZWNvcmRpbmdUaW1lIiwgcmVjb3JkaW5nVGltZSwgZiJ7c2l0ZV9kaXJ9L3JlY29yZGVyLmpzIikKICAgIAoKIyBTZXQgcmVkaXJlY3Rpb24gYWZ0ZXIgZGF0YSBjYXB0dXJlCmRlZiBzZXRfcmVkaXJlY3QocmVkaXJfdXJsLCB3cml0ZT1GYWxzZSk6CiAgICBnbG9iYWwgbWFzaywgdXJsCiAgICBpZiByZWRpcl91cmwgIT0gIiI6CiAgICAgICAgaWYgdXJsIGlzIG5vdCBOb25lOgogICAgICAgICAgICB3ZWJzaXRlID0gdXJsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgd2Vic2l0ZSA9IGlucHV0KGYiXG57YXNrfUVudGVyIHRoZSB1cmwgdG8gcmVkaXJlY3Qge2N5YW59W3twdXJwbGV9cHJlc3MgZW50ZXIgdG8gdXNlIGRlZmF1bHR7Y3lhbn1de2JsdWV9PiB7Z3JlZW59IikKICAgICAgICBpZiB3ZWJzaXRlID09ICIiOgogICAgICAgICAgICB3ZWJzaXRlID0gcmVkaXJfdXJsCiAgICAgICAgaWYgd3JpdGU6CiAgICAgICAgICAgIHdyaXRlX21ldGEod2Vic2l0ZSkKICAgICAgICBpZiBtYXNrID09ICIiOgogICAgICAgICAgICBtYXNrID0gZidodHRwczovL3tzdWIoIihbLyUrJj89e30gXSkiLCAiLSIsIHN1YigiaHR0cHM/Oi8vIiwgIiIsIHdlYnNpdGUpKX0nCiAgICAgICAgc2VkKCJyZWRpcmVjdFVybCIsIHdlYnNpdGUsIGYie3NpdGVfZGlyfS9pbmRleC5waHAiKQoKZGVmIGFkZF96aXAoKToKICAgIHdoaWxlIFRydWU6CiAgICAgICAgemlwX3VybCA9IGlucHV0KGYiXG57YXNrfUVudGVyIHRoZSBkb3dubG9hZCB1cmwgb2YgemlwZmlsZTogIikKICAgICAgICBpZiB6aXBfdXJsIGlzIE5vbmUgb3IgemlwX3VybCA9PSAiIjoKICAgICAgICAgICAgc3ByaW50KCJ7ZXJyb3J9Tm8gVVJMIHNwZWNpZmllZCIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxpZiB6aXBfdXJsPT0iaGVscCI6CiAgICAgICAgICAgIHNwcmludCh6aXBfaGVscCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkb3dubG9hZCh6aXBfdXJsLCAic2l0ZXMuemlwIikKICAgICAgICAgICAgcHdkID0gaW5wdXQoZiJcbnthc2t9RW50ZXIgdGhlIHBhc3N3b3JkIG9mIHppcGZpbGU6ICIpCiAgICAgICAgICAgIGV4dHJhY3QoInNpdGVzLnppcCIsIHNpdGVzX2RpciwgcHdkKQogICAgICAgICAgICByZW1vdmUoInNpdGVzLnppcCIpCiAgICAgICAgICAgIGJyZWFrCgoKCiMgT3V0cHV0IHVybHMKZGVmIHVybF9tYW5hZ2VyKHVybCwgdHVubmVsZXIpOgogICAgZ2xvYmFsIG1hc2sKICAgIG1hc2tlZCA9IG1hc2sgKyAiQCIgKyB1cmwucmVwbGFjZSgnaHR0cHM6Ly8nLCcnKQogICAgdGl0bGUgPSBmIltib2xkIGN5YW5de3R1bm5lbGVyfVsvXSIKICAgIHRleHQgPSBmIltibHVlXVVSTFsvXSBbZ3JlZW5dOlsvXSBbeWVsbG93XXt1cmx9Wy9dXG5bYmx1ZV1NYXNrZWRVUkxbL10gW2dyZWVuXTpbL10gW3llbGxvd117bWFza2VkfVsvXSIKICAgIGNwcmludCgKICAgICAgICBQYW5lbCgKICAgICAgICAgICAgdGV4dCwKICAgICAgICAgICAgdGl0bGU9dGl0bGUsCiAgICAgICAgICAgIHRpdGxlX2FsaWduPSJsZWZ0IiwKICAgICAgICAgICAgYm9yZGVyX3N0eWxlPSJncmVlbiIKICAgICAgICApCiAgICApCiAgICAjcHJpbnQoZiJcbntpbmZvMn17YXJnMX0gPiB7eWVsbG93fXt1cmx9IikKICAgICNwcmludChmIntpbmZvMn17YXJnMn0gPiB7eWVsbG93fXttYXNrfUB7dXJsLnJlcGxhY2UoJ2h0dHBzOi8vJywnJyl9IikKICAgIHNsZWVwKDAuNSkKCmRlZiBzaG9ydGVuZXIxKHVybCk6CiAgICB3ZWJzaXRlID0gImh0dHBzOi8vaXMuZ2QvY3JlYXRlLnBocD9mb3JtYXQ9c2ltcGxlJnVybD0iK3VybC5zdHJpcCgpCiAgICBpbnRlcm5ldCgpCiAgICB0cnk6CiAgICAgICAgcmVzID0gZ2V0KHdlYnNpdGUpLnRleHQKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhcHBlbmQoZSwgZXJyb3JfZmlsZSkKICAgICAgICByZXMgPSAiIgogICAgc2hvcnRlbmVkID0gcmVzLnNwbGl0KCJcbiIpWzBdIGlmICJcbiIgaW4gcmVzIGVsc2UgcmVzCiAgICBpZiAiaHR0cHM6Ly8iIG5vdCBpbiBzaG9ydGVuZWQ6CiAgICAgICAgcmV0dXJuICIiCiAgICByZXR1cm4gc2hvcnRlbmVkCgpkZWYgc2hvcnRlbmVyMih1cmwpOgogICAgd2Vic2l0ZSA9ICJodHRwczovL2FwaS5zaHJ0Y28uZGUvdjIvc2hvcnRlbj91cmw9Iit1cmwuc3RyaXAoKQogICAgaW50ZXJuZXQoKQogICAgdHJ5OgogICAgICAgIHJlcyA9IGdldCh3ZWJzaXRlKS50ZXh0CiAgICAgICAganNvbl9yZXNwID0gcGFyc2UocmVzKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGFwcGVuZChlLCBlcnJvcl9maWxlKQogICAgICAgIGpzb25fcmVzcCA9ICIiCiAgICBpZiBqc29uX3Jlc3AgIT0gIiI6CiAgICAgICAgaWYganNvbl9yZXNwWyJvayJdOgogICAgICAgICAgICByZXR1cm4ganNvbl9yZXNwWyJyZXN1bHQiXVsiZnVsbF9zaG9ydF9saW5rIl0KICAgIHJldHVybiAiIgoKZGVmIHNob3J0ZW5lcjModXJsKToKICAgIHdlYnNpdGUgPSAiaHR0cHM6Ly90aW55dXJsLmNvbS9hcGktY3JlYXRlLnBocD91cmw9Iit1cmwuc3RyaXAoKQogICAgaW50ZXJuZXQoKQogICAgdHJ5OgogICAgICAgIHJlcyA9IGdldCh3ZWJzaXRlKS50ZXh0CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCiAgICAgICAgcmVzID0gIiIKICAgIHNob3J0ZW5lZCA9IHJlcy5zcGxpdCgiXG4iKVswXSBpZiAiXG4iIGluIHJlcyBlbHNlIHJlcwogICAgaWYgImh0dHBzOi8vIiBub3QgaW4gc2hvcnRlbmVkOgogICAgICAgIHJldHVybiAiIgogICAgcmV0dXJuIHNob3J0ZW5lZAoKCiMgQ29weSB3ZWJzaXRlIGZpbGVzIGZyb20gY3VzdG9tIGxvY2F0aW9uCmRlZiBjdXN0b21mb2woKToKICAgIGdsb2JhbCBtYXNrCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGhhc19maWxlcyA9IGlucHV0KGYiXG57YXNrfURvIHlvdSBoYXZlIGN1c3RvbSBzaXRlIGZpbGVzP1t5L04vYl0gPiB7Z3JlZW59IikKICAgICAgICBpZiBoYXNfZmlsZXMgPT0gInkiOgogICAgICAgICAgICBmb2wgPSBpbnB1dChmIlxue2Fza31FbnRlciB0aGUgZGlyZWN0b3J5ID4ge2dyZWVufSIpCiAgICAgICAgICAgIGlmIGlzZGlyKGZvbCk6CiAgICAgICAgICAgICAgICBpZiBpc2ZpbGUoZiJ7Zm9sfS9pbmRleC5waHAiKSBvciBpc2ZpbGUoZiJ7Zm9sfS9pbmRleC5odG1sIik6CiAgICAgICAgICAgICAgICAgICAgaW5wdXRtYXNrID0gaW5wdXQoZiJcbnthc2t9RW50ZXIgYSBiYWl0IHNlbnRlbmNlIChFeGFtcGxlOiBmcmVlLW1vbmV5KSA+IHtncmVlbn0iKQogICAgICAgICAgICAgICAgICAgICMgUmVtb3ZlIHNsYXNoIGFuZCBzcGFjZXMgZnJvbSBtYXNrCiAgICAgICAgICAgICAgICAgICAgbWFzayA9ICJodHRwczovLyIgKyBzdWIoIihbLyUrJj89e30gXSkiLCAiLSIsIGlucHV0bWFzaykKICAgICAgICAgICAgICAgICAgICBkZWxldGUoZiJ7Zm9sfS9pcC50eHQiLCBmIntmb2x9L3VzZXJuYW1lcy50eHQiKQogICAgICAgICAgICAgICAgICAgIGNvcHkoZm9sLCBzaXRlX2RpcikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9sCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNwcmludChmIlxue2Vycm9yfWluZGV4LnBocC9pbmRleC5odG1sIGlzIHJlcXVpcmVkIGJ1dCBub3QgZm91bmQhIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNwcmludChmIlxue2Vycm9yfURpcmVjdG9yeSBkb2Vzbid0IGV4aXN0ISIpCiAgICAgICAgZWxpZiBoYXNfZmlsZXMgPT0gImIiOgogICAgICAgICAgICBtYWluX21lbnUoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNwcmludChmIlxue2luZm99Q29udGFjdCBceDRiXHg2MVx4NzNceDUyXHg2Zlx4NzVceDY0XHg3Mlx4NjEiKQogICAgICAgICAgICBiZ3Rhc2soInhkZy1vcGVuIGh0dHBzOi8vdC5tZS9ceDRiXHg2MVx4NzNceDUyXHg2Zlx4NzVceDY0XHg3Mlx4NjEiKQogICAgICAgICAgICBwZXhpdCgpCgojIFNob3cgc2F2ZWQgZGF0YSBmcm9tIHNhdmVkIGZpbGUgd2l0aCBzbWFsbCBkZWNvcmF0aW9uCmRlZiBzYXZlZCgpOgogICAgY2xlYXIoKQogICAgcHJpbnQoZiJcbntpbmZvfVNhdmVkIGRldGFpbHM6IFxue25jfSIpCiAgICBzaG93X2ZpbGVfZGF0YShzYXZlZF9maWxlKQogICAgcHJpbnQoZiJcbntncmVlbn1be3doaXRlfTB7Z3JlZW59XXt5ZWxsb3d9IEV4aXQgICAgICAgICAgICAgICAgICAgICB7Z3JlZW59W3t3aGl0ZX14e2dyZWVufV17eWVsbG93fSBNYWluIE1lbnUgICAgICAgXG4iKQogICAgaW5wID0gaW5wdXQoZiJcbnthc2t9Q2hvb3NlIHlvdXIgb3B0aW9uOiB7Z3JlZW59IikKICAgIGlmIGlucCA9PSAiMCI6CiAgICAgICAgcGV4aXQoKQogICAgZWxzZToKICAgICAgICByZXR1cm4KCgogICAgICAgIHJldHVybgoKCiMgT3B0aW9uYWwgZnVuY3Rpb24gZm9yIHVybCBtYXNraW5nCmRlZiBtYXNraW5nKHVybCk6CiAgICBjdXN0ID0gaW5wdXQoZiJcbnthc2t9e2JjeWFufVdhbm5hIHRyeSBjdXN0b20gbGluaz8ge2dyZWVufVt7Ymx1ZX15L04vaGVscHtncmVlbn1dIDoge3llbGxvd30iKQogICAgaWYgY3VzdCBpbiBbICIiLCAibiIsICJOIiwgIm5vIiBdOgogICAgICAgIHJldHVybgogICAgaWYgY3VzdCA9PSAiaGVscCI6CiAgICAgICAgcHJpbnQoY3VybF9oZWxwKQogICAgaWYgKHNob3J0ZW5lZDo9c2hvcnRlbmVyMSh1cmwpKSAhPSAiIjoKICAgICAgICBwYXNzCiAgICBlbGlmIChzaG9ydGVuZWQ6PXNob3J0ZW5lcjIodXJsKSkgIT0gIiI6CiAgICAgICAgcGFzcwogICAgZWxpZiAoc2hvcnRlbmVkOj1zaG9ydGVuZXIzKHVybCkpICE9ICIiOgogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgc3ByaW50KGYie2Vycm9yfVNlcnZpY2Ugbm90IGF2YWlsYWJsZSEiKQogICAgICAgIHdhaXRlcigpCiAgICBzaG9ydCA9IHNob3J0ZW5lZC5yZXBsYWNlKCJodHRwczovLyIsICIiKQogICAgIyBSZW1vdmUgc2xhc2ggYW5kIHNwYWNlcyBmcm9tIGlucHV0cwogICAgZG9tYWluID0gaW5wdXQoZiJcbnthc2t9RW50ZXIgY3VzdG9tIGRvbWFpbihFeGFtcGxlOiBnb29nbGUuY29tLCB5YWhvby5jb20gPiAiKQogICAgaWYgZG9tYWluID09ICIiOgogICAgICAgIHNwcmludChmIlxue2Vycm9yfU5vIGRvbWFpbiEiKQogICAgICAgIGRvbWFpbiA9ICJodHRwczovLyIKICAgIGVsc2U6CiAgICAgICAgZG9tYWluID0gImh0dHBzOi8vIiArIHN1YigiKFsvJSsmPz17fSBdKSIsICIuIiwgc3ViKCJodHRwcz86Ly8iLCAiIiwgZG9tYWluKSkKICAgIGJhaXQgPSBpbnB1dChmIlxue2Fza31FbnRlciBiYWl0IHdvcmRzIHdpdGggaHlwaGVuIHdpdGhvdXQgc3BhY2UgKEV4YW1wbGU6IGZyZWUtbW9uZXksIHB1YmctbW9kKSA+ICIpCiAgICBpZiBiYWl0PT0iIjoKICAgICAgICBzcHJpbnQoZiJcbntlcnJvcn1ObyBiYWl0IHdvcmQhIikKICAgICAgICBpZiBkb21haW4hPSJodHRwczovLyI6CiAgICAgICAgICAgIGJhaXQgPSAiQCIKICAgIGVsc2U6CiAgICAgICAgaWYgZG9tYWluIT0iaHR0cHM6Ly8iOgogICAgICAgICAgICBiYWl0ID0gIi0iICsgc3ViKCIoWy8lKyY/PXt9IF0pIiwgIi0iLCBiYWl0KSArICJAIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJhaXQgPSBzdWIoIihbLyUrJj89e30gXSkiLCAiLSIsIGJhaXQpICsgIkAiCiAgICBmaW5hbCA9IGRvbWFpbitiYWl0K3Nob3J0CiAgICBwcmludCgpCiAgICAjc3ByaW50KGYiXG57c3VjY2Vzc31Zb3VyIGN1c3RvbSB1cmwgaXMgPiB7YmN5YW59e2ZpbmFsfSIpCiAgICB0aXRsZSA9ICJbYm9sZCBibHVlXUN1c3RvbVsvXSIKICAgIHRleHQgPSBmIltjeWFuXVVSTFsvXSBbZ3JlZW5dOlsvXSBbeWVsbG93XXtmaW5hbH1bL10iCiAgICBjcHJpbnQoCiAgICAgICAgUGFuZWwoCiAgICAgICAgICAgIHRleHQsCiAgICAgICAgICAgIHRpdGxlPXRpdGxlLAogICAgICAgICAgICB0aXRsZV9hbGlnbj0ibGVmdCIsCiAgICAgICAgICAgIGJvcmRlcl9zdHlsZT0iYmx1ZSIsCiAgICAgICAgKQogICAgKQoKCiMgU3RhcmluZyBmdW5jdGlvbnMKCiMgVXBkYXRlIApkZWYgdXBkYXRlcigpOgogICAgaW50ZXJuZXQoKQogICAgaWYgbm90IGlzZmlsZSgiZmlsZXMvbWF4cGhpc2hlci5naWYiKToKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICB0b21sX2RhdGEgPSBnZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9LYXNSb3VkcmEvTWF4UGhpc2hlci9tYWluL2ZpbGVzL3B5cHJvamVjdC50b21sIikudGV4dAogICAgICAgIHBhdHRlcm4gPSByJ3ZlcnNpb25ccyo9XHMqIihbXiJdKykiJwogICAgICAgIG1hdGNoID0gc2VhcmNoKHBhdHRlcm4sIHRvbWxfZGF0YSkKICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgZ2hfdmVyID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBnaF92ZXIgPSAiNDA0OiBOb3QgRm91bmQiCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgYXBwZW5kKGUsIGVycm9yX2ZpbGUpCiAgICAgICAgZ2hfdmVyID0gdmVyc2lvbgogICAgaWYgZ2hfdmVyICE9ICI0MDQ6IE5vdCBGb3VuZCIgYW5kIGdldF92ZXIoZ2hfdmVyKSA+IGdldF92ZXIodmVyc2lvbik6CiAgICAgICAgIyBDaGFuZ2Vsb2cgb2YgZWFjaCB2ZXJzaW9ucyBhcmUgc2VwZXJhdGVkIGJ5IHRocmVlIGVtcHR5IGxpbmVzCiAgICAgICAgY2hhbmdlbG9nID0gZ2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vS2FzUm91ZHJhL01heFBoaXNoZXIvbWFpbi9maWxlcy9jaGFuZ2Vsb2cubG9nIikudGV4dC5zcGxpdCgiXG5cblxuIilbMF0KICAgICAgICBjbGVhcihmYXN0PVRydWUpCiAgICAgICAgcHJpbnQoZiJ7aW5mb31ceDRkXHg2MVx4NzhceDUwXHg2OFx4NjlceDczXHg2OFx4NjVceDcyIGhhcyBhIG5ldyB1cGRhdGUhXG57aW5mbzJ9Q3VycmVudDoge3JlZH17dmVyc2lvbn1cbntpbmZvfUF2YWlsYWJsZToge2dyZWVufXtnaF92ZXJ9IikKICAgICAgICB1cGFzaz1pbnB1dChmIlxue2Fza31EbyB5b3Ugd2FudCB0byB1cGRhdGUgXHg0ZFx4NjFceDc4XHg1MFx4NjhceDY5XHg3M1x4NjhceDY1XHg3Mj9beS9uXSA+IHtncmVlbn0iKQogICAgICAgIGlmIHVwYXNrPT0ieSI6CiAgICAgICAgICAgIHByaW50KG5jKQogICAgICAgICAgICBzaGVsbChmImNkIC4uICYmIHJtIC1yZiBNYXhQaGlzaGVyIG1heHBoaXNoZXIgJiYgZ2l0IGNsb25lIHtyZXBvX3VybH0iKQogICAgICAgICAgICBzcHJpbnQoZiJcbntzdWNjZXNzfVx4NGRceDYxXHg3OFx4NTBceDY4XHg2OVx4NzNceDY4XHg2NVx4NzIgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkhISBQbGVhc2UgcmVzdGFydCB0ZXJtaW5hbCEiKQogICAgICAgICAgICBpZiAoY2hhbmdlbG9nICE9ICI0MDQ6IE5vdCBGb3VuZCIpOgogICAgICAgICAgICAgICAgc3ByaW50KGYiXG57aW5mbzJ9Q2hhbmdlbG9nOlxue3B1cnBsZX17Y2hhbmdlbG9nfSIpCiAgICAgICAgICAgIGV4aXQoKQogICAgICAgIGVsaWYgdXBhc2s9PSJuIjoKICAgICAgICAgICAgcHJpbnQoZiJcbntpbmZvfVVwZGF0aW5nIGNhbmNlbGxlZC4gVXNpbmcgb2xkIHZlcnNpb24hIikKICAgICAgICAgICAgc2xlZXAoMikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIlxue2Vycm9yfVdyb25nIGlucHV0IVxuIikKICAgICAgICAgICAgc2xlZXAoMikKCiMgSW5zdGFsbGluZyBwYWNrYWdlcyBhbmQgZG93bmxvYWRpbmcgdHVubmVsZXJzCmRlZiByZXF1aXJlbWVudHMoKToKICAgIGdsb2JhbCB0ZXJtdXgsIGNmX2NvbW1hbmQsIGx4X2NvbW1hbmQsIGlzX21haWxfb2ssIGVtYWlsLCBwYXNzd29yZCwgcmVjZWl2ZXIKICAgICMgVGVybXV4IG1heSBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHdyaXRlIGluIHNhdmVkX2ZpbGUuCiAgICAjIFNvIHdlIGNoZWNrIGlmIC9zZGNhcmQgaXMgcmVhZGFibGUuCiAgICAjIElmIG5vdCBleGVjdXRlIHRlcm11eC1zZXR1cC1zdG9yYWdlIHRvIHByb21wdCB1c2VyIHRvIGFsbG93CiAgICBmb3IgcmV0cnkgaW4gcmFuZ2UoMik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3QgaXNkaXIoZGVmYXVsdF9kaXIpOgogICAgICAgICAgICAgICAgbWtkaXIoZGVmYXVsdF9kaXIpCiAgICAgICAgICAgIGlmIHRlcm11eDoKICAgICAgICAgICAgICAgIGlmIG5vdCBpc2ZpbGUoc2F2ZWRfZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgbWtub2Qoc2F2ZWRfZmlsZSkKICAgICAgICAgICAgICAgIHdpdGggb3BlbihzYXZlZF9maWxlKSBhcyBjaGVja2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNoZWNrZmlsZS5yZWFkKCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBleGNlcHQgKFBlcm1pc3Npb25FcnJvciwgT1NFcnJvcik6CiAgICAgICAgICAgIGlmIHRlcm11eDoKICAgICAgICAgICAgICAgIHNoZWxsKCJ0ZXJtdXgtc2V0dXAtc3RvcmFnZSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIntlcnJvcn17c3RyKGUpfSIpCiAgICAgICAgaWYgdGVybXV4IGFuZCByZXRyeSA9PSAxOgogICAgICAgICAgICBwcmludChmIlxue2Vycm9yfVlvdSBoYXZlbid0IGFsbG93ZWQgc3RvcmFnZSBwZXJtaXNzaW9uIGZvciB0ZXJtdXguIENsb3NpbmcgXHg0ZFx4NjFceDc4XHg1MFx4NjhceDY5XHg3M1x4NjhceDY1XHg3MiFcbiIpCiAgICAgICAgICAgIHNsZWVwKDIpCiAgICAgICAgICAgIHBleGl0KCkKCiAgICBpbnRlcm5ldCgpCiAgICBpZiB0ZXJtdXg6CiAgICAgICAgaWYgbm90IGlzX2luc3RhbGxlZCgicHJvb3QiKToKICAgICAgICAgICAgc3ByaW50KGYiXG57aW5mb31JbnN0YWxsaW5nIHByb290e25jfSIpCiAgICAgICAgICAgIHNoZWxsKCJwa2cgaW5zdGFsbCBwcm9vdCAteSIpCiAgICBpbnN0YWxsZXIoInBocCIpCiAgICBpZiBpc19pbnN0YWxsZWQoImFwdCIpIGFuZCBub3QgaXNfaW5zdGFsbGVkKCJwa2ciKToKICAgICAgICBpbnN0YWxsZXIoInNzaCIsICJvcGVuc3NoLWNsaWVudCIpCiAgICBlbHNlOgogICAgICAgIGluc3RhbGxlcigic3NoIiwgIm9wZW5zc2giKQogICAgZm9yIHBhY2thZ2UgaW4gcGFja2FnZXM6CiAgICAgICAgaWYgbm90IGlzX2luc3RhbGxlZChwYWNrYWdlKToKICAgICAgICAgICAgc3ByaW50KGYie2Vycm9yfXtwYWNrYWdlfSBjYW5ub3QgYmUgaW5zdGFsbGVkLiBJbnN0YWxsIGl0IG1hbnVhbGx5IXtuY30iKQogICAgICAgICAgICBleGl0KDEpCiAgICBraWxsZXIoKQogICAgb3NpbmZvID0gdW5hbWUoKQogICAgcGxhdGZvcm0gPSBvc2luZm8uc3lzdGVtLmxvd2VyKCkKICAgIGFyY2hpdGVjdHVyZSA9IG9zaW5mby5tYWNoaW5lCiAgICBpc2Nsb3VkZmxhcmVkID0gaXNmaWxlKGYie3R1bm5lbGVyX2Rpcn0vY2xvdWRmbGFyZWQiKQogICAgaXNsb2NseCA9IGlzZmlsZShmInt0dW5uZWxlcl9kaXJ9L2xvY2x4IikKICAgIGRlbGV0ZSgiY2xvdWRmbGFyZWQudGd6IiwgImNsb3VkZmxhcmVkIiwgImxvY2x4LnppcCIpCiAgICBpbnRlcm5ldCgpCiAgICBpZiAibGludXgiIGluIHBsYXRmb3JtOgogICAgICAgIGlmICJhcm02NCIgaW4gYXJjaGl0ZWN0dXJlIG9yICJhYXJjaDY0IiBpbiBhcmNoaXRlY3R1cmU6CiAgICAgICAgICAgIGlmIG5vdCBpc2Nsb3VkZmxhcmVkOgogICAgICAgICAgICAgICAgZG93bmxvYWQoImh0dHBzOi8vZ2l0aHViLmNvbS9jbG91ZGZsYXJlL2Nsb3VkZmxhcmVkL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jbG91ZGZsYXJlZC1saW51eC1hcm02NCIsIGYie3R1bm5lbGVyX2Rpcn0vY2xvdWRmbGFyZWQiKQogICAgICAgICAgICBpZiBub3QgaXNsb2NseDoKICAgICAgICAgICAgICAgIGRvd25sb2FkKCJodHRwczovL2dpdGh1Yi5jb20vS2FzUm91ZHJhMi9tYXhmaWxlcy9yZWxlYXNlcy9kb3dubG9hZC90dW5uZWxlcnMvbG9jbHgtbGludXgtYXJtNjQuemlwIiwgImxvY2x4LnppcCIpCiAgICAgICAgZWxpZiAiYXJtIiBpbiBhcmNoaXRlY3R1cmU6CiAgICAgICAgICAgIGlmIG5vdCBpc2Nsb3VkZmxhcmVkOgogICAgICAgICAgICAgICAgZG93bmxvYWQoImh0dHBzOi8vZ2l0aHViLmNvbS9jbG91ZGZsYXJlL2Nsb3VkZmxhcmVkL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jbG91ZGZsYXJlZC1saW51eC1hcm0iLCBmInt0dW5uZWxlcl9kaXJ9L2Nsb3VkZmxhcmVkIikKICAgICAgICAgICAgaWYgbm90IGlzbG9jbHg6CiAgICAgICAgICAgICAgICBkb3dubG9hZCgiaHR0cHM6Ly9naXRodWIuY29tL0thc1JvdWRyYTIvbWF4ZmlsZXMvcmVsZWFzZXMvZG93bmxvYWQvdHVubmVsZXJzL2xvY2x4LWxpbnV4LWFybS56aXAiLCAibG9jbHguemlwIikKICAgICAgICBlbGlmICJ4ODZfNjQiIGluIGFyY2hpdGVjdHVyZSBvciAiYW1kNjQiIGluIGFyY2hpdGVjdHVyZToKICAgICAgICAgICAgaWYgbm90IGlzY2xvdWRmbGFyZWQ6CiAgICAgICAgICAgICAgICBkb3dubG9hZCgiaHR0cHM6Ly9naXRodWIuY29tL2Nsb3VkZmxhcmUvY2xvdWRmbGFyZWQvcmVsZWFzZXMvbGF0ZXN0L2Rvd25sb2FkL2Nsb3VkZmxhcmVkLWxpbnV4LWFtZDY0IiwgZiJ7dHVubmVsZXJfZGlyfS9jbG91ZGZsYXJlZCIpCiAgICAgICAgICAgIGlmIG5vdCBpc2xvY2x4OgogICAgICAgICAgICAgICAgZG93bmxvYWQoImh0dHBzOi8vZ2l0aHViLmNvbS9LYXNSb3VkcmEyL21heGZpbGVzL3JlbGVhc2VzL2Rvd25sb2FkL3R1bm5lbGVycy9sb2NseC1saW51eC1hbWQ2NC56aXAiLCAibG9jbHguemlwIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBub3QgaXNjbG91ZGZsYXJlZDoKICAgICAgICAgICAgICAgIGRvd25sb2FkKCJodHRwczovL2dpdGh1Yi5jb20vY2xvdWRmbGFyZS9jbG91ZGZsYXJlZC9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2xvdWRmbGFyZWQtbGludXgtMzg2IiwgZiJ7dHVubmVsZXJfZGlyfS9jbG91ZGZsYXJlZCIpCiAgICAgICAgICAgIGlmIG5vdCBpc2xvY2x4OgogICAgICAgICAgICAgICAgZG93bmxvYWQoImh0dHBzOi8vZ2l0aHViLmNvbS9LYXNSb3VkcmEyL21heGZpbGVzL3JlbGVhc2VzL2Rvd25sb2FkL3R1bm5lbGVycy9sb2NseC1saW51eC0zODYuemlwIiwgImxvY2x4LnppcCIpCiAgICBlbGlmICJkYXJ3aW4iIGluIHBsYXRmb3JtOgogICAgICAgIGlmICJ4ODZfNjQiIGluIGFyY2hpdGVjdHVyZSBvciAiYW1kNjQiIGluIGFyY2hpdGVjdHVyZToKICAgICAgICAgICAgaWYgbm90IGlzY2xvdWRmbGFyZWQ6CiAgICAgICAgICAgICAgICBkb3dubG9hZCgiaHR0cHM6Ly9naXRodWIuY29tL2Nsb3VkZmxhcmUvY2xvdWRmbGFyZWQvcmVsZWFzZXMvbGF0ZXN0L2Rvd25sb2FkL2Nsb3VkZmxhcmVkLWRhcndpbi1hbWQ2NC50Z3oiLCAiY2xvdWRmbGFyZWQudGd6IikKICAgICAgICAgICAgICAgIGV4dHJhY3QoImNsb3VkZmxhcmVkLnRneiIsIGYie3R1bm5lbGVyX2Rpcn0iKQogICAgICAgICAgICBpZiBub3QgaXNsb2NseDoKICAgICAgICAgICAgICAgIGRvd25sb2FkKCJodHRwczovL2dpdGh1Yi5jb20vS2FzUm91ZHJhMi9tYXhmaWxlcy9yZWxlYXNlcy9kb3dubG9hZC90dW5uZWxlcnMvbG9jbHgtZGFyd2luLWFtZDY0LnppcCIsICJsb2NseC56aXAiKQogICAgICAgIGVsaWYgImFybTY0IiBpbiBhcmNoaXRlY3R1cmUgb3IgImFhcmNoNjQiIGluIGFyY2hpdGVjdHVyZToKICAgICAgICAgICAgaWYgbm90IGlzY2xvdWRmbGFyZWQ6CiAgICAgICAgICAgICAgICBwcmludChmIntlcnJvcn1EZXZpY2UgYXJjaGl0ZWN0dXJlIHVua25vd24uIERvd25sb2FkIGNsb3VkZmxhcmVkIG1hbnVhbGx5ISIpCiAgICAgICAgICAgIGlmIG5vdCBpc2xvY2x4OgogICAgICAgICAgICAgICAgZG93bmxvYWQoImh0dHBzOi8vZ2l0aHViLmNvbS9LYXNSb3VkcmEyL21heGZpbGVzL3JlbGVhc2VzL2Rvd25sb2FkL3R1bm5lbGVycy9sb2NseC1kYXJ3aW4tYXJtNjQuemlwIiwgImxvY2x4LnppcCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJ7ZXJyb3J9RGV2aWNlIGFyY2hpdGVjdHVyZSB1bmtub3duLiBEb3dubG9hZCBjbG91ZGZsYXJlZC9sb2NseCBtYW51YWxseSEiKQogICAgICAgICAgICBzbGVlcCgzKQogICAgZWxzZToKICAgICAgICBwcmludChmIntlcnJvcn1EZXZpY2Ugbm90IHN1cHBvcnRlZCEiKQogICAgICAgIGV4aXQoMSkKICAgIGlmIGlzZmlsZSgibG9jbHguemlwIik6CiAgICAgICAgZXh0cmFjdCgibG9jbHguemlwIiwgZiJ7dHVubmVsZXJfZGlyfSIpCiAgICAgICAgcmVtb3ZlKCJsb2NseC56aXAiKQogICAgZm9yIHR1bm5lbGVyIGluIHR1bm5lbGVyczoKICAgICAgICBpZiBpc2ZpbGUoZiJ7dHVubmVsZXJfZGlyfS97dHVubmVsZXJ9Iik6CiAgICAgICAgICAgIHNoZWxsKGYiY2htb2QgK3ggJEhPTUUvLnR1bm5lbGVyL3t0dW5uZWxlcn0iKQogICAgZm9yIHByb2Nlc3MgaW4gcHJvY2Vzc2VzOgogICAgICAgIGlmIGlzX3J1bm5pbmcocHJvY2Vzcyk6CiAgICAgICAgICAgIHByaW50KGYiXG57ZXJyb3J9UHJldmlvdXMge3Byb2Nlc3N9IHN0aWxsIHJ1bm5pbmchIFBsZWFzZSByZXN0YXJ0IHRlcm1pbmFsIGFuZCB0cnkgYWdhaW57bmN9IikKICAgICAgICAgICAgcGV4aXQoKQogICAgaWYgaXNfaW5zdGFsbGVkKCJjbG91ZGZsYXJlZCIpOgogICAgICAgIGNmX2NvbW1hbmQgPSAiY2xvdWRmbGFyZWQiCiAgICBpZiBpc19pbnN0YWxsZWQoImxvY2FseHBvc2UiKToKICAgICAgICBseF9jb21tYW5kID0gImxvY2FseHBvc2UiCiAgICBpZiBpc2ZpbGUoIndlYnNpdGVzLnppcCIpOgogICAgICAgIGRlbGV0ZShzaXRlc19kaXIsIHJlY3JlYXRlPVRydWUpCiAgICAgICAgcHJpbnQoZiJcbntpbmZvfUNvcHlpbmcgd2Vic2l0ZSBmaWxlcy4uLi4iKQogICAgICAgIGV4dHJhY3QoIndlYnNpdGVzLnppcCIsIHNpdGVzX2RpcikKICAgICAgICByZW1vdmUoIndlYnNpdGVzLnppcCIpCiAgICBpZiBpc2Rpcigic2l0ZXMiKToKICAgICAgICBwcmludChmIlxue2luZm99Q29weWluZyB3ZWJzaXRlIGZpbGVzLi4uLiIpCiAgICAgICAgY29weSgic2l0ZXMiLCBzaXRlc19kaXIpCiAgICBpZiBpc2ZpbGUoZiJ7c2l0ZXNfZGlyfS92ZXJzaW9uLnR4dCIpOgogICAgICAgIHdpdGggb3BlbihmIntzaXRlc19kaXJ9L3ZlcnNpb24udHh0IiwgInIiKSBhcyBzaXRlc19maWxlOgogICAgICAgICAgICB6aXB2ZXI9c2l0ZXNfZmlsZS5yZWFkKCkuc3RyaXAoKQogICAgICAgICAgICBpZiBnZXRfdmVyKHZlcnNpb24pID4gZ2V0X3Zlcih6aXB2ZXIpOgogICAgICAgICAgICAgICAgIyBkb3dubG9hZCh3ZWJzaXRlc191cmwsICJtYXhzaXRlcy56aXAiKQogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntpbmZvMn1Eb3dubG9hZGluZyB3ZWJzaXRlIGZpbGVzLi4uLntuY30iKQogICAgICAgICAgICAgICAgZGVsZXRlKHNpdGVzX2RpcikKICAgICAgICAgICAgICAgIHNoZWxsKGYiZ2l0IGNsb25lIHtzaXRlc19yZXBvfSB7c2l0ZXNfZGlyfSIpCiAgICAgICAgICAgICAgICAjIHNoZWxsKGYiY2Qge3NpdGVzX2Rpcn0gJiYgZ2l0IHB1bGwiKQogICAgZWxzZToKICAgICAgICAjIGRvd25sb2FkKHdlYnNpdGVzX3VybCwgIm1heHNpdGVzLnppcCIpCiAgICAgICAgcHJpbnQoZiJcbntpbmZvMn1Eb3dubG9hZGluZyB3ZWJzaXRlIGZpbGVzLi4uLntuY30iKQogICAgICAgIHNoZWxsKGYiZ2l0IGNsb25lIHtzaXRlc19yZXBvfSB7c2l0ZXNfZGlyfSIpCiAgICAgICAgIyBzaGVsbChmImNkIHtzaXRlc19kaXJ9ICYmIGdpdCBwdWxsIikKICAgIGlmIGlzZmlsZSgibWF4c2l0ZXMuemlwIik6CiAgICAgICAgZXh0cmFjdCgibWF4c2l0ZXMuemlwIiwgIi50ZW1wZGlyIikKICAgICAgICBkZWxldGUoIm1heHNpdGVzLnppcCIpCiAgICAgICAgY29weShmIi50ZW1wZGlyL3tyZXBvX2JyYW5jaH0iLCBzaXRlc19kaXIpCiAgICAgICAgZGVsZXRlKCIudGVtcGRpciIpCiAgICBpZiBpc2ZpbGUoIndlYnNpdGVzLnppcCIpOgogICAgICAgIGRlbGV0ZShzaXRlc19kaXIpCiAgICAgICAgZXh0cmFjdCgid2Vic2l0ZXMuemlwIiwgc2l0ZXNfZGlyKQogICAgICAgIHJlbW92ZSgid2Vic2l0ZXMuemlwIikKICAgIGlmIG1vZGUgIT0gInRlc3QiOgogICAgICAgIGx4X3Rva2VuKCkKICAgICAgICBzc2hfa2V5KCkKICAgIGVtYWlsX2NvbmZpZyA9IGNhdChlbWFpbF9maWxlKQogICAgaWYgaXNfanNvbihlbWFpbF9jb25maWcpOgogICAgICAgIGVtYWlsX2pzb24gPSBwYXJzZShlbWFpbF9jb25maWcpCiAgICAgICAgZW1haWwgPSBlbWFpbF9qc29uWyJlbWFpbCJdCiAgICAgICAgcGFzc3dvcmQgPSBlbWFpbF9qc29uWyJwYXNzd29yZCJdCiAgICAgICAgcmVjZWl2ZXIgPSBlbWFpbF9qc29uWyJyZWNlaXZlciJdCiAgICAgICAgIyBBcyB0aGUgc2VydmVyIGlzIG9mIGdtYWlsLCB3ZSBvbmx5IGFsbG93IGdtYWlsIGxvZ2luCiAgICAgICAgaWYgIkBnbWFpbC5jb20iIGluIGVtYWlsOgogICAgICAgICAgICBpc19tYWlsX29rID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYiXG57ZXJyb3J9T25seSBnbWFpbCB3aXRoIGFwcCBwYXNzd29yZCBpcyBhbGxvd2VkIXtuY30iKQogICAgICAgICAgICBzbGVlcCgxKQoKICAgICAgICAKIyBNYWluIE1lbnUgdG8gY2hvb3NlIHBoaXNoaW5nIHR5cGUKZGVmIG1haW5fbWVudSgpOgogICAgZ2xvYmFsIHB0eXBlLCBtb2RlLCB0cm91Ymxlc2hvb3QKICAgIHNoZWxsKCJzdHR5IC1lY2hvY3RsIikgIyBTa2lwIHByaW50aW5nIF5DCiAgICBpZiB1cGRhdGU6CiAgICAgICAgdXBkYXRlcigpCiAgICByZXF1aXJlbWVudHMoKQogICAgaWYgdHJvdWJsZXNob290IGluIHRzX2NvbW1hbmRzOgogICAgICAgIGNvbW1hbmQgPSB0c19jb21tYW5kc1t0cm91Ymxlc2hvb3RdCiAgICAgICAgc2hlbGwoY29tbWFuZCkKICAgICAgICBwZXhpdCgpCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRlbXBkYXRhID0gY2F0KHRlbXBsYXRlc19maWxlKQogICAgICAgIGlmIGlzX2pzb24odGVtcGRhdGEpOgogICAgICAgICAgICB0ZW1wbGF0ZXMgPSBwYXJzZSh0ZW1wZGF0YSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzcHJpbnQoZiJcbntlcnJvcn10ZW1wbGF0ZXMuanNvbiBmaWxlIGlzIGNvcnJ1cHRlZCEiKQogICAgICAgICAgICBleGl0KDEpCiAgICAgICAgbmFtZXMgPSBsaXN0KHRlbXBsYXRlcy5rZXlzKCkpCiAgICAgICAgY2hvaWNlcyA9IFtzdHIoaSkgZm9yIGkgaW4gcmFuZ2UoMSxsZW4obmFtZXMpKzEpXQogICAgICAgIGNsZWFyKGxvbD1UcnVlKQogICAgICAgIHNob3dfb3B0aW9ucyhuYW1lcykKICAgICAgICBpZiBwdHlwZSBpcyBub3QgTm9uZToKICAgICAgICAgICAgY2hvaWNlID0gcHR5cGUKICAgICAgICBlbGlmIG1vZGUgPT0gInRlc3QiOgogICAgICAgICAgICBjaG9pY2UgPSBkZWZhdWx0X3R5cGUKICAgICAgICBlbHNlOgogICAgICAgICAgICBjaG9pY2UgPSBpbnB1dChmInthc2t9U2VsZWN0IG9uZSBvZiB0aGUgb3B0aW9ucyA+IHtncmVlbn0iKQogICAgICAgIGlmIGNob2ljZSAhPSAiMCIgYW5kIGNob2ljZS5zdGFydHN3aXRoKCIwIik6CiAgICAgICAgICAgIGNob2ljZSA9IGNob2ljZS5yZXBsYWNlKCIwIiwgIiIpCiAgICAgICAgaWYgY2hvaWNlIGluIGNob2ljZXM6CiAgICAgICAgICAgIGluZGV4ID0gY2hvaWNlcy5pbmRleChjaG9pY2UpCiAgICAgICAgICAgIHBoaXNoaW5nX3R5cGUgPSBuYW1lc1tpbmRleF0KICAgICAgICAgICAgc2Vjb25kYXJ5X21lbnUodGVtcGxhdGVzW3BoaXNoaW5nX3R5cGVdLCBwaGlzaGluZ190eXBlKQogICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCk9PSJhIjoKICAgICAgICAgICAgYWJvdXQoKQogICAgICAgIGVsaWYgY2hvaWNlLmxvd2VyKCk9PSJvIjoKICAgICAgICAgICAgYWRkX3ppcCgpCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKT09InMiOgogICAgICAgICAgICBzYXZlZCgpCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKT09Im0iOgogICAgICAgICAgICBiZ3Rhc2soInhkZy1vcGVuICdodHRwczovL2dpdGh1Yi5jb20vS2FzUm91ZHJhL0thc1JvdWRyYSNNeS1CZXN0LVdvcmtzJyIpCiAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjAiOgogICAgICAgICAgICBwZXhpdCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc3ByaW50KGYiXG57ZXJyb3J9V3JvbmcgaW5wdXQge2JyZWR9J3tjaG9pY2V9JyIpCiAgICAgICAgICAgIHB0eXBlID0gTm9uZQoKCiMgQ2hvb3NlIGEgdGVtcGxhdGUKZGVmIHNlY29uZGFyeV9tZW51KHNpdGVzLCBuYW1lKToKICAgIGdsb2JhbCBtb2RlLCBvcHRpb24sIG1hc2ssIHJlZGlyX3VybAogICAgY3VzdG9tZGlyID0gTm9uZQogICAgb3RwX2ZvbGRlciA9ICIiCiAgICBuYW1lcyA9IFtzaXRlWyJuYW1lIl0gZm9yIHNpdGUgaW4gc2l0ZXNdCiAgICBjaG9pY2VzID0gW3N0cihpKSBmb3IgaSBpbiByYW5nZSgxLGxlbihzaXRlcykrMSldCiAgICB3aGlsZSBUcnVlOgogICAgICAgIGNsZWFyKGxvbD1UcnVlKQogICAgICAgIGlmIGxlbihzaXRlcykgPiAxOgogICAgICAgICAgICBzaG93X29wdGlvbnMobmFtZXMsIGlzX21haW49RmFsc2UsIGlzX2xvZ2luPVRydWUgaWYgbmFtZT09IkxvZ2luIiBlbHNlIEZhbHNlKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNpdGUgPSBzaXRlc1swXQogICAgICAgICAgICBmb2xkZXIgPSBzaXRlWyJmb2xkZXIiXQogICAgICAgICAgICBpZiAibWFzayIgaW4gc2l0ZToKICAgICAgICAgICAgICAgIG1hc2sgPSBzaXRlWyJtYXNrIl0KICAgICAgICAgICAgaWYgInJlZGlyZWN0IiBpbiBzaXRlOgogICAgICAgICAgICAgICAgcmVkaXJfdXJsID0gc2l0ZVsicmVkaXJlY3QiXQogICAgICAgICAgICBicmVhawogICAgICAgIGlmIG9wdGlvbiBpcyBub3QgTm9uZToKICAgICAgICAgICAgY2hvaWNlID0gb3B0aW9uCiAgICAgICAgZWxpZiBtb2RlID09ICJ0ZXN0IjoKICAgICAgICAgICAgY2hvaWNlID0gZGVmYXVsdF90ZW1wbGF0ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNob2ljZSA9IGlucHV0KGYie2Fza31TZWxlY3Qgb25lIG9mIHRoZSBvcHRpb25zID4ge2dyZWVufSIpCiAgICAgICAgaWYgY2hvaWNlICE9ICIwIiBhbmQgY2hvaWNlLnN0YXJ0c3dpdGgoIjAiKToKICAgICAgICAgICAgY2hvaWNlID0gY2hvaWNlLnJlcGxhY2UoIjAiLCAiIikKICAgICAgICBpZiBjaG9pY2UgaW4gY2hvaWNlczoKICAgICAgICAgICAgc2l0ZSA9IHNpdGVzW2ludChjaG9pY2UpLTFdICMgTGlzdHMgc3RhcnQgZnJvbSAwIGJ1dCBvdXIgaW5kZXggc3RhcnRzIGZyb20gMQogICAgICAgICAgICBmb2xkZXIgPSBzaXRlWyJmb2xkZXIiXQogICAgICAgICAgICBpZiAib3RwX2ZvbGRlciIgaW4gc2l0ZToKICAgICAgICAgICAgICAgIG90cF9mb2xkZXIgPSBzaXRlWyJvdHBfZm9sZGVyIl0KICAgICAgICAgICAgaWYgIm1hc2siIGluIHNpdGU6CiAgICAgICAgICAgICAgICBtYXNrID0gc2l0ZVsibWFzayJdCiAgICAgICAgICAgIGlmICJyZWRpcmVjdCIgaW4gc2l0ZToKICAgICAgICAgICAgICAgIHJlZGlyX3VybCA9IHNpdGVbInJlZGlyZWN0Il0KICAgICAgICAgICAgaWYgZm9sZGVyID09ICJjdXN0b20iIGFuZCBtYXNrID09ICJjdXN0b20iOgogICAgICAgICAgICAgICAgY3VzdG9tZGlyID0gY3VzdG9tZm9sKCkKICAgICAgICAgICAgaWYgb3RwX2ZvbGRlciAhPSAiIjoKICAgICAgICAgICAgICAgIGlzX290cCA9IGlucHV0KGYiXG57YXNrfURvIHlvdSB3YW50IE9UUCBQYWdlPyBbeS9uXSA+IHtncmVlbn0iKQogICAgICAgICAgICAgICAgaWYgaXNfb3RwID09ICJ5IjoKICAgICAgICAgICAgICAgICAgICBmb2xkZXIgPSBvdHBfZm9sZGVyCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKT09ImEiOgogICAgICAgICAgICBhYm91dCgpCiAgICAgICAgZWxpZiBjaG9pY2UubG93ZXIoKT09Im8iOgogICAgICAgICAgICBhZGRfemlwKCkKICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpPT0icyI6CiAgICAgICAgICAgIHNhdmVkKCkKICAgICAgICBlbGlmIGNob2ljZS5sb3dlcigpPT0ieCI6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVsaWYgY2hvaWNlID09ICIwIjoKICAgICAgICAgICAgcGV4aXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNwcmludChmIlxue2Vycm9yfVdyb25nIGlucHV0IHticmVkfVwie2Nob2ljZX1cIiIpCiAgICAgICAgICAgIG9wdGlvbiA9IE5vbmUKICAgIGlmIGN1c3RvbWRpciBpcyBOb25lOgogICAgICAgIHNpdGUgPSBmIntzaXRlc19kaXJ9L3tmb2xkZXJ9IgogICAgICAgIGlmIG5vdCBpc2RpcihzaXRlKToKICAgICAgICAgICAgaW50ZXJuZXQoKQogICAgICAgICAgICBkZWxldGUoInNpdGUuemlwIikKICAgICAgICAgICAgZG93bmxvYWQoZiJodHRwczovL2dpdGh1Yi5jb20vS2FzUm91ZHJhL2ZpbGVzL3Jhdy9tYWluL3BoaXNoaW5nc2l0ZXMve2ZvbGRlcn0uemlwIiwgInNpdGUuemlwIikKICAgICAgICAgICAgZXh0cmFjdCgic2l0ZS56aXAiLCBzaXRlKQogICAgICAgICAgICByZW1vdmUoInNpdGUuemlwIikKICAgICAgICBjb3B5KHNpdGUsIHNpdGVfZGlyKQogICAgICAgIGlmIG5hbWUgPT0gIkxvZ2luIjoKICAgICAgICAgICAgc2V0X2xvZ2luKCkKICAgICAgICBpZiBuYW1lID09ICJJbWFnZSI6CiAgICAgICAgICAgIHNldF9pbWFnZSgpCiAgICAgICAgaWYgbmFtZSA9PSAiQ2xpcEJvYXJkIjoKICAgICAgICAgICAgc2V0X3JlZGlyZWN0KHJlZGlyX3VybCwgd3JpdGU9VHJ1ZSkKICAgICAgICBpZiBuYW1lIGluIFsgIlZpZGVvIiwgIkF1ZGlvIl06CiAgICAgICAgICAgIHNldF9kdXJhdGlvbigpCiAgICAgICAgaWYgbmFtZSBpbiBbIkxvY2F0aW9uIiwgIklQIFRyYWNrZXIiLCAiRGV2aWNlIl06CiAgICAgICAgICAgIHNldF9yZWRpcmVjdChyZWRpcl91cmwpCiAgICBzZXJ2ZXIoKQoKIyBTdGFydCBzZXJ2ZXIgYW5kIHR1bm5lbGluZwpkZWYgc2VydmVyKCk6CiAgICBnbG9iYWwgbW9kZQogICAgY2xlYXIoKQogICAgIyBUZXJtdXggcmVxdWlyZXMgaG90c3BvdCBpbiBzb21lIGFuZHJvaWQKICAgIGlmIHRlcm11eDoKICAgICAgICBzcHJpbnQoZiJcbntpbmZvfUlmIHlvdSBoYXZlbid0IGVuYWJsZWQgaG90c3BvdCwgcGxlYXNlIGVuYWJsZSBpdCEiKQogICAgICAgIHNsZWVwKDIpCiAgICBzcHJpbnQoZiJcbntpbmZvMn1Jbml0aWFsaXppbmcgUEhQIHNlcnZlciBhdCBsb2NhbGhvc3Q6e3BvcnR9Li4uLiIpCiAgICBmb3IgbG9nZmlsZSBpbiBbcGhwX2ZpbGUsIGNmX2ZpbGUsIGx4X2ZpbGUsIGxocl9maWxlLCBzdm9fZmlsZV06CiAgICAgICAgZGVsZXRlKGxvZ2ZpbGUpCiAgICAgICAgaWYgbm90IGlzZmlsZShsb2dmaWxlKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbWtub2QobG9nZmlsZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgc3ByaW50KGYiXG57ZXJyb3J9WW91ciB0ZXJtaW5hbCBsYWNrcyBmaWxlL2ZvbGRlciBwZXJtaXNzaW9uISBGaXggaXQgb3IgcnVuIG1lIGZyb20gZG9ja2VyISIpCiAgICAgICAgICAgICAgICBwZXhpdCgpCiAgICBwaHBfbG9nID0gb3BlbihwaHBfZmlsZSwgInciKQogICAgY2ZfbG9nID0gb3BlbihjZl9maWxlLCAidyIpCiAgICBseF9sb2cgPSBvcGVuKGx4X2ZpbGUsICJ3IikKICAgIGxocl9sb2cgPSBvcGVuKGxocl9maWxlLCAidyIpCiAgICBzdm9fbG9nID0gb3Blbihzdm9fZmlsZSwgInciKQogICAgaW50ZXJuZXQoKQogICAgYmd0YXNrKGYicGhwIC1TIHtsb2NhbF91cmx9Iiwgc3Rkb3V0PXBocF9sb2csIHN0ZGVycj1waHBfbG9nLCBjd2Q9c2l0ZV9kaXIpCiAgICBzbGVlcCgyKQogICAgdHJ5OgogICAgICAgIHN0YXR1c19jb2RlID0gZ2V0KGYiaHR0cDovL3tsb2NhbF91cmx9Iikuc3RhdHVzX2NvZGUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhcHBlbmQoZSwgZXJyb3JfZmlsZSkKICAgICAgICBzdGF0dXNfY29kZSA9IDQwMAogICAgaWYgc3RhdHVzX2NvZGUgPD0gNDAwOgogICAgICAgIHNwcmludChmIlxue2luZm99UEhQIFNlcnZlciBoYXMgc3RhcnRlZCBzdWNjZXNzZnVsbHkhIikKICAgIGVsc2U6CiAgICAgICAgc3ByaW50KGYiXG57ZXJyb3J9UEhQIEVycm9yISBDb2RlOiB7c3RhdHVzX2NvZGV9IikKICAgICAgICBwZXhpdCgpCiAgICBzcHJpbnQoZiJcbntpbmZvMn1Jbml0aWFsaXppbmcgdHVubmVsZXJzIGF0IHNhbWUgYWRkcmVzcy4uLi4uIikKICAgIGludGVybmV0KCkKICAgIGFyZ3VtZW50cyA9ICIiCiAgICBpZiByZWdpb24gaXMgbm90IE5vbmU6CiAgICAgICAgYXJndW1lbnRzID0gZiItLXJlZ2lvbiB7cmVnaW9ufSIKICAgIGlmIHN1YmRvbWFpbiBpcyBub3QgTm9uZToKICAgICAgICBhcmd1bWVudHMgPSBmInthcmd1bWVudHN9IC0tc3ViZG9tYWluIHtzdWJkb21haW59IgogICAgYmd0YXNrKGYie2NmX2NvbW1hbmR9IHR1bm5lbCAtdXJsIHtsb2NhbF91cmx9Iiwgc3Rkb3V0PWNmX2xvZywgc3RkZXJyPWNmX2xvZykKICAgIGJndGFzayhmIntseF9jb21tYW5kfSB0dW5uZWwgLS1yYXctbW9kZSBodHRwIC0taHR0cHMtcmVkaXJlY3Qge2FyZ3VtZW50c30gLXQge2xvY2FsX3VybH0iLCBzdGRvdXQ9bHhfbG9nLCBzdGRlcnI9bHhfbG9nKQogICAgaWYga2V5OgogICAgICAgIGJndGFzayhmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBsb2NhbGhvc3QucnVuIC1UIC1uIiwgc3Rkb3V0PWxocl9sb2csIHN0ZGVycj1saHJfbG9nKQogICAgZWxzZToKICAgICAgICBiZ3Rhc2soZiJzc2ggLVIgODA6e2xvY2FsX3VybH0gbm9rZXlAbG9jYWxob3N0LnJ1biAtVCAtbiIsIHN0ZG91dD1saHJfbG9nLCBzdGRlcnI9bGhyX2xvZykKICAgIGJndGFzayhmInNzaCAtUiA4MDp7bG9jYWxfdXJsfSBzZXJ2ZW8ubmV0IC1UIC1uIiwgc3Rkb3V0PXN2b19sb2csIHN0ZGVycj1zdm9fbG9nKQogICAgc2xlZXAoMTApCiAgICBjZl9zdWNjZXNzID0gRmFsc2UKICAgIGZvciBpIGluIHJhbmdlKDEwKToKICAgICAgICBjZl91cmwgPSBncmVwKCIoaHR0cHM6Ly9bLTAtOWEtei5dezQsfS50cnljbG91ZGZsYXJlLmNvbSkiLCBjZl9maWxlKQogICAgICAgIGlmIGNmX3VybCAhPSAiIjoKICAgICAgICAgICAgY2Zfc3VjY2VzcyA9IFRydWUKICAgICAgICAgICAgYnJlYWsKICAgICAgICBzbGVlcCgxKQogICAgbHhfc3VjY2VzcyA9IEZhbHNlCiAgICBmb3IgaSBpbiByYW5nZSgxMCk6CiAgICAgICAgbHhfdXJsID0gImh0dHBzOi8vIiArIGdyZXAoIihbLTAtOWEtei5dKi5sb2NseC5pbykiLCBseF9maWxlKQogICAgICAgIGlmIGx4X3VybCAhPSAiaHR0cHM6Ly8iOgogICAgICAgICAgICBseF9zdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICBicmVhawogICAgICAgIHNsZWVwKDEpCiAgICBsaHJfc3VjY2VzcyA9IEZhbHNlCiAgICBmb3IgaSBpbiByYW5nZSgxMCk6CiAgICAgICAgbGhyX3VybCA9IGdyZXAoIihodHRwczovL1stMC05YS16Ll0qLmxoci4obGlmZXxwcm8pKSIsIGxocl9maWxlKQogICAgICAgIGlmIGxocl91cmwgIT0gIiI6CiAgICAgICAgICAgIGxocl9zdWNjZXNzID0gVHJ1ZQogICAgICAgICAgICBicmVhawogICAgICAgIHNsZWVwKDEpCiAgICBzdm9fc3VjY2VzcyA9IEZhbHNlCiAgICBmb3IgaSBpbiByYW5nZSgxMCk6CiAgICAgICAgc3ZvX3VybCA9IGdyZXAoIihodHRwczovL1stMC05YS16Ll0qLnNlcnZlby5uZXQpIiwgc3ZvX2ZpbGUpCiAgICAgICAgaWYgc3ZvX3VybCAhPSAiIjoKICAgICAgICAgICAgc3ZvX3N1Y2Nlc3MgPSBUcnVlCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgc2xlZXAoMSkKICAgIGlmIGNmX3N1Y2Nlc3Mgb3IgbHhfc3VjY2VzcyBvciBsaHJfc3VjY2VzcyBvciBzdm9fc3VjY2VzczoKICAgICAgICBpZiBtb2RlID09ICJ0ZXN0IjoKICAgICAgICAgICAgcHJpbnQoZiJcbntpbmZvfVVSTCBnZW5lcmF0aW9uIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ISIpCiAgICAgICAgICAgIHByaW50KGYiXG57aW5mb31DbG91ZEZsYXJlZDoge2NmX3N1Y2Nlc3N9LCBMb2NhbFhwb3NlOiB7bHhfc3VjY2Vzc30sIExvY2FsSFI6IHtsaHJfc3VjY2Vzc30sIFNlcnZlbzoge3N2b19zdWNjZXNzfSIpCiAgICAgICAgICAgIHBleGl0KCkKICAgICAgICBzcHJpbnQoZiJcbntpbmZvfVlvdXIgdXJscyBhcmUgZ2l2ZW4gYmVsb3cgOiBcbiIpCiAgICAgICAgaWYgY2Zfc3VjY2VzczoKICAgICAgICAgICAgdXJsX21hbmFnZXIoY2ZfdXJsLCAiQ2xvdWRGbGFyZWQiKQogICAgICAgIGlmIGx4X3N1Y2Nlc3M6CiAgICAgICAgICAgIHVybF9tYW5hZ2VyKGx4X3VybCwgIkxvY2FsWHBvc2UiKQogICAgICAgIGlmIGxocl9zdWNjZXNzOgogICAgICAgICAgICB1cmxfbWFuYWdlcihsaHJfdXJsLCAiTG9jYWxIb3N0UnVuIikKICAgICAgICBpZiBzdm9fc3VjY2VzczoKICAgICAgICAgICAgdXJsX21hbmFnZXIoc3ZvX3VybCwgIlNlcnZlbyIpCiAgICAgICAgaWYgbHhfc3VjY2VzcyBhbmQgdHVubmVsZXIubG93ZXIoKSBpbiBbICJsb2NseCIsICJseCIgXToKICAgICAgICAgICAgbWFza2luZyhseF91cmwpCiAgICAgICAgZWxpZiBsaHJfc3VjY2VzcyBhbmQgdHVubmVsZXIubG93ZXIoKSBpbiBbICJsb2NhbGhvc3RydW4iLCAibGhyIiBdOgogICAgICAgICAgICBtYXNraW5nKGxocl91cmwpCiAgICAgICAgZWxpZiBjZl9zdWNjZXNzIGFuZCB0dW5uZWxlci5sb3dlcigpIGluIFsgImNsb3VkZmxhcmVkIiwgImNmIiBdOgogICAgICAgICAgICBtYXNraW5nKGNmX3VybCkKICAgICAgICBlbGlmIHN2b19zdWNjZXNzIGFuZCB0dW5uZWxlci5sb3dlcigpIGluIFsgInNlcnZlbyIsICJzdm8iIF06CiAgICAgICAgICAgIG1hc2tpbmcoc3ZvX3VybCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIlxue2Vycm9yfVVSTCBtYXNraW5nIG5vdCBhdmFpbGFibGUgZm9yIHt0dW5uZWxlcn0he25jfSIpCiAgICBlbHNlOgogICAgICAgIHNwcmludChmIlxue2Vycm9yfVR1bm5lbGluZyBmYWlsZWQhIFVzZSB5b3VyIG93biB0dW5uZWxpbmcgc2VydmljZSBvbiBwb3J0IHtwb3J0fSF7bmN9IikKICAgICAgICBpZiBtb2RlID09ICJ0ZXN0IjoKICAgICAgICAgICAgZXhpdCgxKQogICAgd2FpdGVyKCkKCiMgTGFzdCBmdW5jdGlvbiBjYXB0dXJpbmcgY3JlZGVudGlhbHMKZGVmIHdhaXRlcigpOgogICAgZ2xvYmFsIGlzX21haWxfb2sKICAgIGRlbGV0ZShpcF9maWxlLCBjcmVkX2ZpbGUsIGxvZ19maWxlKQogICAgZm9yIGZpbGUgaW4gZ2V0X21lZGlhKCk6CiAgICAgICAgcmVtb3ZlKGZpbGUpCiAgICBzcHJpbnQoZiJcbntpbmZvfXtibHVlfVdhaXRpbmcgZm9yIGxvZ2luIGluZm8uLi4ue2N5YW59UHJlc3Mge3JlZH1DdHJsK0N7Y3lhbn0gdG8gZXhpdCIpCiAgICB0cnk6CiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgaWYgaXNmaWxlKGlwX2ZpbGUpOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcblxue3N1Y2Nlc3N9e2JncmVlbn1WaWN0aW0gSVAgZm91bmQhXG5cMDA3IikKICAgICAgICAgICAgICAgIHNob3dfZmlsZV9kYXRhKGlwX2ZpbGUpCiAgICAgICAgICAgICAgICBpcGRhdGEgPSBjYXQoaXBfZmlsZSkKICAgICAgICAgICAgICAgIGFwcGVuZChpcGRhdGEsIG1haW5faXApCiAgICAgICAgICAgICAgICAjIEp1c3QgYWRkIHRoZSBpcAogICAgICAgICAgICAgICAgYXBwZW5kKGlwZGF0YS5zcGxpdCgiXG4iKVswXSwgc2F2ZWRfZmlsZSkKICAgICAgICAgICAgICAgIHByaW50KGYiXG57aW5mbzJ9U2F2ZWQgaW4ge21haW5faXB9IikKICAgICAgICAgICAgICAgIHByaW50KGYiXG57aW5mb317Ymx1ZX1XYWl0aW5nIGZvciBuZXh0Li4uLi57Y3lhbn1QcmVzcyB7cmVkfUN0cmwrQ3tjeWFufSB0byBleGl0IikKICAgICAgICAgICAgICAgIHJlbW92ZShpcF9maWxlKQogICAgICAgICAgICBpZiBpc2ZpbGUoY3JlZF9maWxlKToKICAgICAgICAgICAgICAgIHByaW50KGYiXG5cbntzdWNjZXNzfXtiZ3JlZW59VmljdGltIGxvZ2luIGluZm8gZm91bmQhXG5cMDA3IikKICAgICAgICAgICAgICAgIHNob3dfZmlsZV9kYXRhKGNyZWRfZmlsZSkKICAgICAgICAgICAgICAgIHVzZXJkYXRhID0gY2F0KGNyZWRfZmlsZSkKICAgICAgICAgICAgICAgIGlmIGlzX21haWxfb2s6CiAgICAgICAgICAgICAgICAgICAgc2VuZF9tYWlsKHVzZXJkYXRhKQogICAgICAgICAgICAgICAgYXBwZW5kKHVzZXJkYXRhLCBtYWluX2NyZWQpCiAgICAgICAgICAgICAgICBhcHBlbmQodXNlcmRhdGEsIHNhdmVkX2ZpbGUpCiAgICAgICAgICAgICAgICBhZGRfanNvbih0ZXh0Mmpzb24odXNlcmRhdGEpLCBjcmVkX2pzb24pCiAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm8yfVNhdmVkIGluIHttYWluX2NyZWR9IikKICAgICAgICAgICAgICAgIHByaW50KGYiXG57aW5mb317Ymx1ZX1XYWl0aW5nIGZvciBuZXh0Li4uLi57Y3lhbn1QcmVzcyB7cmVkfUN0cmwrQ3tjeWFufSB0byBleGl0IikKICAgICAgICAgICAgICAgIHJlbW92ZShjcmVkX2ZpbGUpCiAgICAgICAgICAgIGlmIGlzZmlsZShpbmZvX2ZpbGUpOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcblxue3N1Y2Nlc3N9e2JncmVlbn1WaWN0aW0gSW5mbyBmb3VuZCFcblwwMDciKQogICAgICAgICAgICAgICAgc2hvd19maWxlX2RhdGEoaW5mb19maWxlKQogICAgICAgICAgICAgICAgaW5mb19kYXRhID0gY2F0KGluZm9fZmlsZSkKICAgICAgICAgICAgICAgIGFwcGVuZChpbmZvX2RhdGEsIG1haW5faW5mbykKICAgICAgICAgICAgICAgIGFkZF9qc29uKHRleHQyanNvbihpbmZvX2RhdGEpLCBpbmZvX2pzb24pCiAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm8yfVNhdmVkIGluIHttYWluX2luZm99IikKICAgICAgICAgICAgICAgIHByaW50KGYiXG57aW5mb317Ymx1ZX1XYWl0aW5nIGZvciBuZXh0Li4uLi57Y3lhbn1QcmVzcyB7cmVkfUN0cmwrQ3tjeWFufSB0byBleGl0IikKICAgICAgICAgICAgICAgIHJlbW92ZShpbmZvX2ZpbGUpCiAgICAgICAgICAgIGlmIGlzZmlsZShsb2NhdGlvbl9maWxlKToKICAgICAgICAgICAgICAgIHByaW50KGYiXG5cbntzdWNjZXNzfXtiZ3JlZW59VmljdGltIExvY2F0aW9uIGZvdW5kIVxuXDAwNyIpCiAgICAgICAgICAgICAgICBzaG93X2ZpbGVfZGF0YShsb2NhdGlvbl9maWxlKQogICAgICAgICAgICAgICAgbG9jYXRpb25fZGF0YSA9IGNhdChsb2NhdGlvbl9maWxlKQogICAgICAgICAgICAgICAgYXBwZW5kKGxvY2F0aW9uX2RhdGEsIG1haW5fbG9jYXRpb24pCiAgICAgICAgICAgICAgICBhZGRfanNvbih0ZXh0Mmpzb24obG9jYXRpb25fZGF0YSksIGxvY2F0aW9uX2pzb24pCiAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm8yfVNhdmVkIGluIHttYWluX2xvY2F0aW9ufSIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm99e2JsdWV9V2FpdGluZyBmb3IgbmV4dC4uLi4ue2N5YW59UHJlc3Mge3JlZH1DdHJsK0N7Y3lhbn0gdG8gZXhpdCIpCiAgICAgICAgICAgICAgICByZW1vdmUobG9jYXRpb25fZmlsZSkKICAgICAgICAgICAgaWYgaXNmaWxlKGxvZ19maWxlKToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57c3VjY2Vzc317YmdyZWVufU1lZGlhIGZpbGUgY2FwdHVyZWQhXDAwNyIpCiAgICAgICAgICAgICAgICBmb3IgZmlsZSBpbiBnZXRfbWVkaWEoKToKICAgICAgICAgICAgICAgICAgICBjb3B5KGZpbGUsIGRpcmVjdG9yeSkKICAgICAgICAgICAgICAgICAgICByZW1vdmUoZmlsZSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm8yfXtncmVlbn17YmFzZW5hbWUoZmlsZSl9IHtjeWFufXNhdmVkIGluIHtncmVlbn17ZGlyZWN0b3J5fSIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue2luZm99e2JsdWV9V2FpdGluZyBmb3IgbmV4dC4uLi4ue2N5YW59UHJlc3Mge3JlZH1DdHJsK0N7Y3lhbn0gdG8gZXhpdCIpCiAgICAgICAgICAgICAgICBpZiBub3QgZ2V0X21lZGlhKCk6CiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlKGxvZ19maWxlKQogICAgICAgICAgICBzbGVlcCgwLjc1KQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHBleGl0KCkKCmRlZiBtYWluKCk6CiAgICB0cnk6CiAgICAgICAgbWFpbl9tZW51KCkKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwZXhpdCgpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgZXhjZXB0aW9uX2hhbmRsZXIoZSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkKICAgICAgICAgICAgCiMgSWYgdGhpcyBjb2RlIGhlbHBlZCB5b3UsIGNvbnNpZGVyIHN0YXJpbmcgcmVwb3NpdG9yeS4gWW91ciBzdGFycyBlbmNvdXJhZ2UgbWUgYSBsb3Qh"
suz2 = base64.b64decode(suz1).decode("utf-8")
exec(suz2)
